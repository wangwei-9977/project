(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-65ab4e8f"],{"544a":function(t,l,e){"use strict";e.d(l,"c",(function(){return a})),e.d(l,"b",(function(){return c})),e.d(l,"a",(function(){return s}));var o=e("dabb");function a(t){return Object(o["a"])({url:"/attend/clock/create",method:"post",data:t})}function c(t){return Object(o["a"])({url:"/attend/my/query-clocks",method:"post",data:t})}function s(t){return Object(o["a"])({url:"/attend/clock/del",method:"post",data:t})}},b4c9:function(t,l,e){"use strict";e.d(l,"a",(function(){return a})),e.d(l,"c",(function(){return c})),e.d(l,"b",(function(){return s}));var o=e("dabb");function a(t){return Object(o["a"])({url:"/attend/classes/create",method:"post",data:t})}function c(t){return Object(o["a"])({url:"/attend/my/query-classes",method:"post",data:t})}function s(t){return Object(o["a"])({url:"/attend/classes/del",method:"post",data:t})}},dabb:function(t,l,e){"use strict";e("d3b7");var o=e("bc3a"),a=e.n(o),c=e("5c96"),s=e("4360"),n=e("5f87");a.a.defaults.headers["Content-Type"]="application/json;charset=utf-8";var i=a.a.create({baseURL:"http://172.20.112.56:9001",timeout:3e4});function r(t){return{request_source:"",verify_code:"",request_time:(new Date).getTime(),token:s["a"].getters.token?Object(n["a"])():"",content:t}}i.interceptors.request.use((function(t){return s["a"].getters.token&&(t.headers["X-Token"]=Object(n["a"])()),"post"===t.method&&(t.type||(t.data=r(t.data)),console.log(t.data)),t}),(function(t){console.log(t),Promise.reject(t)})),i.interceptors.response.use((function(t){var l=t.data;return 5e3!==l.result_code?(Object(c["Message"])({message:l.result_desc,type:"error",duration:5e3}),5008!==l.result_code&&5012!==l.result_code&&5014!==l.result_code||c["MessageBox"].confirm("你已被登出，可以取消继续留在该页面，或者重新登录","确定登出",{confirmButtonText:"重新登录",cancelButtonText:"取消",type:"warning"}).then((function(){s["a"].dispatch("FedLogOut").then((function(){location.reload()}))})),Promise.reject("error")):t.data}),(function(t){return console.log("err"+t),Object(c["Message"])({message:"发生未知错误,请联系管理员.",type:"error",duration:5e3}),Promise.reject(t)})),l["a"]=i},f298:function(t,l,e){},f70a:function(t,l,e){"use strict";e.r(l);var o=function(){var t=this,l=t.$createElement,e=t._self._c||l;return e("div",{staticClass:"app-container"},[e("el-form",{ref:"classes",attrs:{model:t.query_classes,inline:!0,"label-width":"68px"}},[e("el-form-item",{attrs:{label:"班次名称",prop:"att_cla_name"}},[e("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入班次名称"},model:{value:t.query_classes.att_cla_name,callback:function(l){t.$set(t.query_classes,"att_cla_name",l)},expression:"query_classes.att_cla_name"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:t.getClasses}},[t._v("搜索")]),e("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:t.resetQuery}},[t._v("重置")])],1)],1),e("el-row",{staticClass:"mb8",attrs:{gutter:10}},[e("el-col",{attrs:{span:1.5}},[e("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["attendance:classes:add"],expression:"['attendance:classes:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:t.preAddClasses}},[t._v("新增")])],1),e("right-toolbar",{attrs:{showSearch:t.showSearch},on:{"update:showSearch":function(l){t.showSearch=l},"update:show-search":function(l){t.showSearch=l},queryTable:t.getClasses}})],1),e("el-table",{attrs:{data:t.classes,"header-cell-class-name":t.tableHeadClassName,"cell-class-name":t.tableRowClassName}},[e("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e("el-table-column",{attrs:{prop:"att_cla_name",label:"班次名称",align:"center"}}),e("el-table-column",{attrs:{label:"考勤时间"},scopedSlots:t._u([{key:"default",fn:function(l){return l.row.claCloDtosList&&l.row.claCloDtosList.length>0?t._l(l.row.claCloDtosList,(function(l){return e("div",{key:l.clo_id},[t._v(" "+t._s(t.formatAttendTime(l))+" ")])})):void 0}}],null,!0)}),e("el-table-column",{attrs:{formatter:t.formatTotalHour,label:"总工时",align:"center"}}),e("el-table-column",{attrs:{prop:"att_cla_isElastic",label:"是否弹性",width:"100"},scopedSlots:t._u([{key:"default",fn:function(l){return[e("el-tag",{attrs:{type:1===l.row.att_cla_isElastic?"primary":"warning","disable-transitions":""}},[t._v(t._s(t.isElastic(l.row.att_cla_isElastic)))])]}}])}),e("el-table-column",{attrs:{prop:"option",label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(l){return[e("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["attendance:classes:edit"],expression:"['attendance:classes:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(e){return t.preUpdateClasses(l.row)}}},[t._v("修改")]),e("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["attendance:classes:remove"],expression:"['attendance:classes:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(e){return t.deleteClassesById(l.row.att_cla_id)}}},[t._v("删除")])]}}])})],1),e("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total_rows>0,expression:"total_rows > 0"}],attrs:{total:t.total_rows,page:t.current_page,limit:t.page_rows},on:{"update:page":function(l){t.current_page=l},"update:limit":function(l){t.page_rows=l},pagination:t.getClasses}}),e("el-dialog",{attrs:{visible:t.uploadClassesVisible,title:t.classes_title},on:{"update:visible":function(l){t.uploadClassesVisible=l}}},[e("el-form",{attrs:{model:t.class_clock,size:"mini"}},[e("el-form-item",{attrs:{label:"班次名称"}},[e("el-input",{staticStyle:{width:"120px"},attrs:{"auto-complete":"on"},model:{value:t.class_clock.att_cla_name,callback:function(l){t.$set(t.class_clock,"att_cla_name",l)},expression:"class_clock.att_cla_name"}})],1),e("el-form-item",{attrs:{label:"是否弹性"}},[e("el-select",{staticStyle:{width:"80px"},attrs:{filterable:""},model:{value:t.class_clock.att_cla_isElastic,callback:function(l){t.$set(t.class_clock,"att_cla_isElastic",l)},expression:"class_clock.att_cla_isElastic"}},[e("el-option",{attrs:{value:1,label:"是"}}),e("el-option",{attrs:{value:0,label:"否"}})],1)],1),0==t.class_clock.att_cla_isElastic?e("el-form-item",[e("label",[t._v("设置时间段")])]):t._e(),e("el-form-item",[0==t.class_clock.att_cla_isElastic?e("el-table",{ref:"clockTable",staticStyle:{width:"100%"},attrs:{data:t.class_clock.claCloDtosList,"tooltip-effect":"dark",size:"mini"}},[e("el-table-column",{attrs:{prop:"clo_name",label:"时间段"}}),e("el-table-column",{attrs:{formatter:t.genOnWorkTime,label:"上班时间段"}}),e("el-table-column",{attrs:{formatter:t.genOffWorkTime,label:"下班时间段"}}),e("el-table-column",{attrs:{formatter:t.allowLateTime,label:"允许迟到时间"}}),e("el-table-column",{attrs:{formatter:t.allowEarlyTime,label:"允许早退时间"}}),e("el-table-column",{attrs:{prop:"delete",label:"操作",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(l){return[e("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.preUpdateClock(l.row)}}},[t._v("编辑")])]}}],null,!1,1296911147)})],1):t._e()],1),e("el-form-item",{attrs:{label:"总工时"}},[e("el-input",{staticStyle:{width:"80px"},attrs:{disabled:0==t.class_clock.att_cla_isElastic,"auto-complete":"on"},model:{value:t.class_clock.att_cla_totalHours,callback:function(l){t.$set(t.class_clock,"att_cla_totalHours",l)},expression:"class_clock.att_cla_totalHours"}}),e("span",[t._v("小时")])],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(l){t.uploadClassesVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.updateClasses}},[t._v("确 定")])],1)],1),e("el-dialog",{attrs:{visible:t.updateClockVisible,width:"800px",title:"添加时间段"},on:{"update:visible":function(l){t.updateClockVisible=l}}},[e("el-form",{attrs:{model:t.clock,size:"mini","label-width":"50px"}},[e("el-form-item",{attrs:{label:"时段"}},[e("el-select",{staticStyle:{width:"120px"},attrs:{filterable:"",disabled:"",placeholder:"请选择时段"},on:{change:t.clockChange},model:{value:t.clock.clo_name,callback:function(l){t.$set(t.clock,"clo_name",l)},expression:"clock.clo_name"}},t._l(t.all_clocks,(function(t){return e("el-option",{key:t.clo_id,attrs:{label:t.clo_name,value:t}})})),1)],1),e("el-form-item",{attrs:{label:"上班"}},[e("div",{staticClass:"agent-value"},[e("el-time-picker",{staticStyle:{width:"120px"},attrs:{"picker-options":{selectableRange:"00:00:00 - 23:59:59"},size:"mini",placeholder:"开始时间",format:"HH:mm:ss"},model:{value:t.clock.onWorkClockDate,callback:function(l){t.$set(t.clock,"onWorkClockDate",l)},expression:"clock.onWorkClockDate"}}),e("div",{staticClass:"agent-label"},[t._v("~")]),e("el-time-picker",{staticStyle:{width:"120px"},attrs:{"picker-options":{selectableRange:"00:00:00 - 23:59:59"},size:"mini",placeholder:"结束时间",format:"HH:mm:ss"},model:{value:t.clock.onWorkDate,callback:function(l){t.$set(t.clock,"onWorkDate",l)},expression:"clock.onWorkDate"}})],1),e("div",{staticClass:"agent-label"},[t._v(" 允许迟到 "),e("el-input-number",{staticClass:"_input_num",attrs:{min:0,max:60,"controls-position":"right"},model:{value:t.clock.allowLateTime,callback:function(l){t.$set(t.clock,"allowLateTime",l)},expression:"clock.allowLateTime"}}),t._v(" 分钟 ")],1),e("div",{staticClass:"agent-label"},[e("el-select",{staticClass:"_input_sort",attrs:{filterable:""},model:{value:t.clock.onWorkClockState,callback:function(l){t.$set(t.clock,"onWorkClockState",l)},expression:"clock.onWorkClockState"}},[e("el-option",{attrs:{value:1,label:"必须"}}),e("el-option",{attrs:{value:0,label:"不用"}})],1),t._v(" 打卡 ")],1)]),e("el-form-item",{attrs:{label:"下班"}},[e("div",{staticClass:"agent-value"},[e("el-time-picker",{staticStyle:{width:"120px"},attrs:{"picker-options":{selectableRange:"00:00:00 - 23:59:59"},placeholder:"开始时间",format:"HH:mm:ss"},model:{value:t.clock.offWorkDate,callback:function(l){t.$set(t.clock,"offWorkDate",l)},expression:"clock.offWorkDate"}}),e("span",{staticClass:"agent-label"},[t._v("~")]),e("el-time-picker",{staticStyle:{width:"120px"},attrs:{"picker-options":{selectableRange:"00:00:00 - 23:59:59"},placeholder:"结束时间",format:"HH:mm:ss"},model:{value:t.clock.offWorkClockDate,callback:function(l){t.$set(t.clock,"offWorkClockDate",l)},expression:"clock.offWorkClockDate"}})],1),e("div",{staticClass:"agent-label"},[t._v(" 允许早退 "),e("el-input-number",{staticClass:"_input_num",attrs:{min:0,max:60,"controls-position":"right"},model:{value:t.clock.allowEarlyTime,callback:function(l){t.$set(t.clock,"allowEarlyTime",l)},expression:"clock.allowEarlyTime"}}),t._v(" 分钟 ")],1),e("div",{staticClass:"agent-label"},[e("el-select",{staticClass:"_input_sort",attrs:{filterable:""},model:{value:t.clock.offWorkClockState,callback:function(l){t.$set(t.clock,"offWorkClockState",l)},expression:"clock.offWorkClockState"}},[e("el-option",{attrs:{value:1,label:"必须"}}),e("el-option",{attrs:{value:0,label:"不用"}})],1),t._v(" 打卡 ")],1)])],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.cancelUpdateClock}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.updateClock}},[t._v("确 定")])],1)],1)],1)},a=[],c=(e("d3b7"),e("159b"),e("14d9"),e("a434"),e("b0c0"),e("b4c9")),s=e("544a"),n={data:function(){return{query_classes:{att_cla_name:null,page:null,size:null},clock:{clo_id:null,clo_name:null,onWorkClockDate:null,onWorkDate:null,onWorkClockState:null,offWorkDate:null,offWorkClockDate:null,offWorkClockState:0,allowLateTime:0,allowEarlyTime:0},showSearch:!0,classes_title:"新增",all_clocks:[],classes:[],current_page:1,page_rows:5,total_rows:0,multipleSelection:[],uploadClassesVisible:!1,updateClockVisible:!1,class_clock:{att_cla_id:null,att_cla_name:null,att_cla_isElastic:null,att_cla_totalHours:null,claCloDtosList:[]}}},computed:{},created:function(){this.getAllClocks(),this.getClasses()},methods:{tableHeadClassName:function(){return"table-head"},tableRowClassName:function(t){t.row;var l=t.rowIndex;return l%2==0?"success-row":"warning-row"},getAllClocks:function(){var t=this,l={page:-1};Object(s["b"])(l).then((function(l){5e3===l.result_code?(t.all_clocks=l.content.content,console.log(t.all_clocks)):t.$message.error(l.result_desc)}))},getClasses:function(){var t=this;this.query_classes.page=this.current_page-1,this.query_classes.size=this.page_rows,Object(c["c"])(this.query_classes).then((function(l){console.log(l),5e3===l.result_code?0===l.content.content.length&&t.current_page>1?(t.current_page-=1,t.getClasses()):(t.classes=l.content.content,t.total_rows=l.content.totalElements):t.$message.error(l.result_desc)}))},resetQuery:function(){this.resetForm("query_classes"),this.handleQuery()},deleteClassesById:function(t){var l=this;this.$confirm("此操作将永久删除该时段, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(c["b"])({att_cla_id:t}).then((function(t){5e3===t.result_code?(l.getClasses(),l.$message.success("班次删除成功")):l.$message.error(t.result_desc)}))}))},formatAttendTime:function(t){var l="",e=t.clo_name+":",o="",a="";return 1===t.onWorkClockState&&(t.onWorkClockDate||t.onWorkDate)&&(o=this.formatTime2(new Date(t.onWorkClockDate))+"~"+this.formatTime2(new Date(t.onWorkDate))+"  ",l=e+o),1===t.offWorkClockState&&t.offWorkDate&&t.offWorkClockDate&&(a=this.formatTime2(new Date(t.offWorkDate))+"~"+this.formatTime2(new Date(t.offWorkClockDate)),l=e+o+a),l},formatTotalHour:function(t){return t.att_cla_totalHours+"小时"},isElastic:function(t){return 1===t||"1"===t?"是":"否"},preAddClasses:function(){var t=this;this.classes_title="新增班次",this.class_clock.att_cla_name=null,this.class_clock.claCloDtosList=[],this.class_clock.att_cla_totalHours=0,this.class_clock.att_cla_isElastic=0,this.class_clock.att_cla_id=null,this.all_clocks.forEach((function(l){var e={};e.clo_id=l.clo_id,e.clo_name=l.clo_name,e.onWorkClockDate=null,e.onWorkDate=null,e.onWorkClockState=null,e.offWorkDate=null,e.offWorkClockDate=null,e.offWorkClockState=0,e.allowLateTime=0,e.allowEarlyTime=0,t.class_clock.claCloDtosList.push(e)})),this.culTotalHour(),this.uploadClassesVisible=!0},addClasses:function(){this.uploadClassesVisible=!1},includeClock:function(t,l){if(!t||t.length<=0)return-1;var e=-1;return t.forEach((function(t,o){t.clo_id===l&&(e=o)})),e},preUpdateClasses:function(t){var l=this;this.classes_title="编辑班次",console.log(t),this.class_clock.att_cla_id=t.att_cla_id,this.class_clock.att_cla_name=t.att_cla_name,this.class_clock.att_cla_isElastic=t.att_cla_isElastic,this.class_clock.att_cla_totalHours=t.att_cla_totalHours,this.class_clock.claCloDtosList=[],this.all_clocks.forEach((function(e){var o=l.includeClock(t.claCloDtosList,e.clo_id),a={};o>-1?(a.clo_id=t.claCloDtosList[o].clo_id,a.clo_name=t.claCloDtosList[o].clo_name,a.onWorkClockDate=null===t.claCloDtosList[o].onWorkClockDate?null:new Date(t.claCloDtosList[o].onWorkClockDate),a.onWorkDate=null===t.claCloDtosList[o].onWorkDate?null:new Date(t.claCloDtosList[o].onWorkDate),a.onWorkClockState=t.claCloDtosList[o].onWorkClockState,a.offWorkDate=null===t.claCloDtosList[o].offWorkDate?null:new Date(t.claCloDtosList[o].offWorkDate),a.offWorkClockDate=null===t.claCloDtosList[o].offWorkClockDate?null:new Date(t.claCloDtosList[o].offWorkClockDate),a.offWorkClockState=t.claCloDtosList[o].offWorkClockState,a.allowLateTime=t.claCloDtosList[o].allowLateTime,a.allowEarlyTime=t.claCloDtosList[o].allowEarlyTime):(a.clo_id=e.clo_id,a.clo_name=e.clo_name,a.onWorkClockDate=null,a.onWorkDate=null,a.onWorkClockState=null,a.offWorkDate=null,a.offWorkClockDate=null,a.offWorkClockState=0,a.allowLateTime=0,a.allowEarlyTime=0),l.class_clock.claCloDtosList.push(a)})),this.culTotalHour(),console.log("total hour:"+this.class_clock.att_cla_totalHours),this.uploadClassesVisible=!0},clearClock:function(){this.clock.clo_id=null,this.clock.clo_name=null,this.clock.onWorkClockDate=null,this.clock.onWorkDate=null,this.clock.onWorkClockState=null,this.clock.offWorkDate=null,this.clock.offWorkClockDate=null,this.clock.offWorkClockState=null,this.clock.allowLateTime=null,this.clock.allowEarlyTime=null},cancelUpdateClock:function(){this.clearClock(),this.updateClockVisible=!1},updateClock:function(){var t=this;this.class_clock.claCloDtosList.forEach((function(l){l.clo_id!==t.clock.clo_id||1!==t.clock.onWorkClockState&&1!==t.clock.offWorkClockState||(console.log("时段:"+l.clo_name),l.onWorkClockDate=t.clock.onWorkClockDate,l.onWorkDate=t.clock.onWorkDate,l.onWorkClockState=t.clock.onWorkClockState,l.offWorkDate=t.clock.offWorkDate,l.offWorkClockDate=t.clock.offWorkClockDate,l.offWorkClockState=t.clock.offWorkClockState,l.allowLateTime=t.clock.allowLateTime,l.allowEarlyTime=t.clock.allowEarlyTime)})),this.culTotalHour(),console.log("total hour:"+this.class_clock.att_cla_totalHours),this.updateClockVisible=!1},onOrOffWorkClockState:function(t){return 1===t?"必须":"不用"},updateClasses:function(){var t=this;console.log(this.class_clock),1===this.class_clock.att_cla_isElastic&&(this.class_clock.claCloDtosList=[]),Object(c["a"])(this.class_clock).then((function(l){5e3===l.result_code?("新增班次"===t.classes_title?t.$message.success("新增班次成功"):"编辑班次"===t.classes_title&&t.$message.success("班次修改成功"),t.getClasses()):t.$message.error(l.result_desc)})),this.uploadClassesVisible=!1},formatTime:function(t){if(null!=t&&void 0!==t&&""!==t)return t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()},formatTime2:function(t){if(null!=t&&void 0!==t&&""!==t){var l=t.getHours()<10?"0"+t.getHours():t.getHours(),e=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();return l+":"+e}},formatHour:function(t){if(null!=t&&void 0!==t&&""!==t)return t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()},genOnWorkTime:function(t){return 1!==t.onWorkClockState?"":this.formatTime2(t.onWorkClockDate)+"~"+this.formatTime2(t.onWorkDate)},genOffWorkTime:function(t){return 1!==t.offWorkClockState?"":this.formatTime2(t.offWorkDate)+"~"+this.formatTime2(t.offWorkClockDate)},allowLateTime:function(t){return t.allowLateTime+"分钟"},allowEarlyTime:function(t){return t.allowEarlyTime+"分钟"},preUpdateClock:function(t){console.log("row",t),console.log("row.offWorkDate",t.offWorkDate),console.log("row.offWorkClockDate",t.offWorkClockDate),console.log("row.offWorkClockState",t.offWorkClockState),this.clock.clo_id=t.clo_id,this.clock.clo_name=t.clo_name,this.clock.onWorkClockDate=t.onWorkClockDate,this.clock.onWorkDate=t.onWorkDate,this.clock.onWorkClockState=t.onWorkClockState,this.clock.offWorkDate=t.offWorkDate,this.clock.offWorkClockDate=t.offWorkClockDate,this.clock.offWorkClockState=t.offWorkClockState,this.clock.allowLateTime=t.allowLateTime,this.clock.allowEarlyTime=t.allowEarlyTime,this.updateClockVisible=!0},deleteClock:function(t){console.log(t),this.class_clock.clocks.splice(t,1)},culTotalHour:function(){if(0===this.class_clock.att_cla_isElastic&&this.class_clock.claCloDtosList){var t=0;return console.log("开始计算正常班次的总工时"),this.class_clock.claCloDtosList.forEach((function(l){console.log("时段:"+l.name),l.offWorkDate&&l.onWorkDate&&(console.log(l.offWorkDate),console.log(l.onWorkDate),t+=l.offWorkDate.getTime()-l.onWorkDate.getTime(),console.log("total_time:"+t))})),this.class_clock.att_cla_totalHours=t/36e5,this.class_clock.att_cla_totalHours}return this.class_clock.att_cla_totalHours},clockChange:function(t){this.clock.clo_id=t.clo_id,this.clock.clo_name=t.clo_name},handleSizeChange:function(t){this.page_rows=t},handleCurrentChange:function(t){this.current_page=t,this.getClasses()}}},i=n,r=(e("fdfc"),e("2877")),u=Object(r["a"])(i,o,a,!1,null,null,null);l["default"]=u.exports},fdfc:function(t,l,e){"use strict";e("f298")}}]);