(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-32ce3bfb"],{6533:function(e,t,l){},6820:function(e,t,l){"use strict";l("6533")},"776c":function(e,t,l){"use strict";l.r(t);var s=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"app-container"},[l("div",{staticClass:"depart-list"},[l("div",[l("el-tree",{attrs:{data:e.genFullDeparts,props:e.departProps,"highlight-current":!0,accordion:""},on:{"node-click":e.handleNodeClick}})],1)]),l("div",{staticClass:"depart-detail"},[l("div",{staticClass:"query-box"},[l("el-form",{attrs:{inline:!0,model:e.userQuery,size:"mini"}},[l("el-form-item",{staticClass:"query-item",attrs:{label:"工号"}},[l("el-input",{attrs:{placeholder:"工号"},model:{value:e.userQuery.card_num,callback:function(t){e.$set(e.userQuery,"card_num",t)},expression:"userQuery.card_num"}})],1),l("el-form-item",{staticClass:"query-item",attrs:{label:"姓名"}},[l("el-input",{attrs:{placeholder:"姓名"},model:{value:e.userQuery.user_name,callback:function(t){e.$set(e.userQuery,"user_name",t)},expression:"userQuery.user_name"}})],1),l("el-form-item",{staticClass:"query-item",attrs:{label:"岗位"}},[l("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.userQuery.post_id,callback:function(t){e.$set(e.userQuery,"post_id",t)},expression:"userQuery.post_id"}},e._l(e.hasPostsOfDepart,(function(e){return l("el-option",{key:e.post_id,attrs:{label:e.post_name,value:e.post_id}})})),1)],1),l("el-form-item",{staticClass:"query-item",attrs:{label:"是否在职"}},[l("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.userQuery.work_state,callback:function(t){e.$set(e.userQuery,"work_state",t)},expression:"userQuery.work_state"}},[l("el-option",{attrs:{label:"在职",value:"1"}}),l("el-option",{attrs:{label:"离职",value:"0"}}),l("el-option",{attrs:{label:"休长假",value:"2"}})],1)],1),l("el-form-item",{staticClass:"query-item",attrs:{label:"周期排班"}},[l("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.userQuery.schedule_id,callback:function(t){e.$set(e.userQuery,"schedule_id",t)},expression:"userQuery.schedule_id"}},e._l(e.scheduleList,(function(e){return l("el-option",{key:e.schedule_id,attrs:{label:e.schedule_name,value:e.schedule_id}})})),1)],1),l("el-form-item",[l("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:function(t){return e.getUsersByDepartId(e.current_depart.depart_id)}}},[e._v("搜索")]),l("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1)],1),l("div",{staticClass:"content-box"},[l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingData,expression:"loadingData"}],ref:"multipleUsersTable",attrs:{data:e.query_users,"header-cell-class-name":e.tableHeadClassName,"cell-class-name":e.tableRowClassName},on:{"selection-change":e.handleSelectionChange}},[l("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),l("el-table-column",{attrs:{prop:"card_num",label:"工号",width:"90",align:"center"}}),l("el-table-column",{attrs:{prop:"user_name",label:"姓名",align:"center"}}),l("el-table-column",{attrs:{prop:"work_state",label:"是否在职",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-tag",{attrs:{size:"mini",type:1===t.row.work_state?"primary":"warning","disable-transitions":""}},[e._v(" "+e._s(e.isWorking(t.row.work_state))+" ")])]}}])}),l("el-table-column",{attrs:{prop:"schedule_name",label:"周期排班","min-width":"120",align:"center"}}),l("el-table-column",{attrs:{prop:"user-update",label:"操作","header-align":"center",width:"230"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{type:"text",size:"small"},on:{click:function(l){return e.monthPersonInit(t.row,"look")}}},[e._v("查看")]),l("el-button",{attrs:{type:"text",size:"small"},on:{click:function(l){return e.weekPersonInit(t.row)}}},[e._v("修改周期排班")]),l("el-button",{attrs:{type:"text",size:"small"},on:{click:function(l){return e.monthPersonInit(t.row,"edit")}}},[e._v("修改每日排班")])]}}])})],1),l("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total_rows>0,expression:"total_rows > 0"}],attrs:{total:e.total_rows,page:e.current_page,limit:e.page_rows},on:{"update:page":function(t){e.current_page=t},"update:limit":function(t){e.page_rows=t},pagination:function(t){return e.getUsersByDepartId(e.current_depart.depart_id)}}})],1),l("el-dialog",{attrs:{visible:e.weekVisible,title:"批量修改周期排班"},on:{"update:visible":function(t){e.weekVisible=t}}},[l("el-form",{attrs:{size:"mini",model:e.dialogUserQuery,inline:!0}},[l("el-form-item",{attrs:{label:"部门"}},[l("el-cascader",{staticStyle:{width:"140px"},attrs:{value:e.selectDeparts,options:e.genFullDeparts,props:e.departCascaderProps,clearable:!0,placeholder:"试试搜索：部门",filterable:"",clearable:"","change-on-select":""},on:{change:e.weekDepartChange}})],1),l("el-form-item",{attrs:{label:"岗位"}},[l("el-select",{staticStyle:{width:"140px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.dialogUserQuery.post_id,callback:function(t){e.$set(e.dialogUserQuery,"post_id",t)},expression:"dialogUserQuery.post_id"}},e._l(e.hasPostsOfDepart,(function(e){return l("el-option",{key:e.post_id,attrs:{label:e.post_name,value:e.post_id}})})),1)],1),l("el-form-item",{attrs:{label:"角色"}},[l("el-select",{staticStyle:{width:"140px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.dialogUserQuery.role_id,callback:function(t){e.$set(e.dialogUserQuery,"role_id",t)},expression:"dialogUserQuery.role_id"}},e._l(e.allRoles,(function(e){return l("el-option",{key:e.role_id,attrs:{label:e.role_name,value:e.role_id}})})),1)],1),l("el-form-item",{attrs:{label:"性别"}},[l("el-select",{staticStyle:{width:"140px"},attrs:{clearable:"",placeholder:"请选择"},model:{value:e.dialogUserQuery.user_sex,callback:function(t){e.$set(e.dialogUserQuery,"user_sex",t)},expression:"dialogUserQuery.user_sex"}},[l("el-option",{attrs:{label:"男",value:"男"}}),l("el-option",{attrs:{label:"女",value:"女"}})],1)],1),l("el-form-item",{attrs:{label:"是否注册"}},[l("el-select",{staticStyle:{width:"113px"},attrs:{clearable:"",placeholder:"请选择"},model:{value:e.dialogUserQuery.reg_state,callback:function(t){e.$set(e.dialogUserQuery,"reg_state",t)},expression:"dialogUserQuery.reg_state"}},[l("el-option",{attrs:{label:"已注册",value:"1"}}),l("el-option",{attrs:{label:"未注册",value:"0"}})],1)],1),l("el-form-item",{attrs:{label:"是否在职"}},[l("el-select",{staticStyle:{width:"113px"},attrs:{clearable:"",placeholder:"请选择"},model:{value:e.dialogUserQuery.work_state,callback:function(t){e.$set(e.dialogUserQuery,"work_state",t)},expression:"dialogUserQuery.work_state"}},[l("el-option",{attrs:{label:"在职",value:"1"}}),l("el-option",{attrs:{label:"离职",value:"0"}}),l("el-option",{attrs:{label:"休长假",value:"2"}})],1)],1),l("el-form-item",{attrs:{label:"工号"}},[l("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:"工号",size:"mini"},model:{value:e.dialogUserQuery.card_num,callback:function(t){e.$set(e.dialogUserQuery,"card_num",t)},expression:"dialogUserQuery.card_num"}})],1),l("el-form-item",{attrs:{label:"姓名"}},[l("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:"姓名"},model:{value:e.dialogUserQuery.user_name,callback:function(t){e.$set(e.dialogUserQuery,"user_name",t)},expression:"dialogUserQuery.user_name"}})],1),l("el-form-item",{attrs:{label:"周期排班"}},[l("el-select",{staticStyle:{width:"113px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.dialogUserQuery.schedule_id,callback:function(t){e.$set(e.dialogUserQuery,"schedule_id",t)},expression:"dialogUserQuery.schedule_id"}},e._l(e.scheduleList,(function(e){return l("el-option",{key:e.schedule_id,attrs:{label:e.schedule_name,value:e.schedule_id}})})),1)],1),l("el-form-item",[l("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dialogUserSearch(e.dialogUserQuery.depart_id)}}},[e._v("查询")])],1)],1),l("el-form",{attrs:{size:"mini",model:e.dialogWeekForm,inline:!0}},[l("el-form-item",{attrs:{label:"人员选择",rules:{required:!0,message:"人员选择不能为空",trigger:"blur"},prop:"selectedPersons"}},[l("el-transfer",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogUserLoading,expression:"dialogUserLoading"}],staticStyle:{"margin-left":"70px"},attrs:{data:e.userList,props:e.userProps,titles:["未选择人员","已选择人员"]},model:{value:e.dialogWeekForm.user_ids,callback:function(t){e.$set(e.dialogWeekForm,"user_ids",t)},expression:"dialogWeekForm.user_ids"}})],1),l("el-form-item",{attrs:{label:"周期排班",rules:{required:!0,message:"周期排班不能为空",trigger:"change"},prop:"schedule_id"}},[l("el-select",{staticStyle:{width:"130px"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.dialogWeekForm.schedule_id,callback:function(t){e.$set(e.dialogWeekForm,"schedule_id",t)},expression:"dialogWeekForm.schedule_id"}},e._l(e.scheduleList,(function(e){return l("el-option",{key:e.schedule_id,attrs:{label:e.schedule_name,value:e.schedule_id}})})),1)],1)],1),l("div",{attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{size:"mini"},on:{click:function(t){e.weekVisible=!1}}},[e._v("取 消")]),l("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.weekSubmit}},[e._v("确 定")])],1)],1),l("el-dialog",{attrs:{visible:e.weekPersonVisible,width:"300px",title:"修改个人周期排班"},on:{"update:visible":function(t){e.weekPersonVisible=t}}},[l("el-form",{attrs:{size:"mini",model:e.dialogWeekForm,"label-width":"80px"}},[l("el-form-item",{attrs:{label:"姓名"}},[e._v(" "+e._s(e.weekPersonName)+" ")]),l("el-form-item",{attrs:{label:"周期排班",rules:{required:!0,message:"周期排班不能为空",trigger:"blur"},prop:"schedule_id"}},[l("el-select",{staticStyle:{width:"130px"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.dialogWeekForm.schedule_id,callback:function(t){e.$set(e.dialogWeekForm,"schedule_id",t)},expression:"dialogWeekForm.schedule_id"}},e._l(e.scheduleList,(function(e){return l("el-option",{key:e.schedule_id,attrs:{label:e.schedule_name,value:e.schedule_id}})})),1)],1)],1),l("div",{attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{size:"mini"},on:{click:function(t){e.weekPersonVisible=!1}}},[e._v("取 消")]),l("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.weekSubmit}},[e._v("确 定")])],1)],1),l("el-dialog",{attrs:{visible:e.monthVisible,title:"批量修改每日排班"},on:{"update:visible":function(t){e.monthVisible=t}}},[l("el-form",{attrs:{size:"mini",model:e.dialogUserQuery,inline:!0}},[l("el-form-item",{attrs:{label:"部门"}},[l("el-cascader",{staticStyle:{width:"140px"},attrs:{value:e.selectDeparts,options:e.genFullDeparts,props:e.departCascaderProps,clearable:!0,placeholder:"试试搜索：部门",filterable:"",clearable:"","change-on-select":""},on:{change:e.weekDepartChange}})],1),l("el-form-item",{attrs:{label:"岗位"}},[l("el-select",{staticStyle:{width:"140px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.dialogUserQuery.post_id,callback:function(t){e.$set(e.dialogUserQuery,"post_id",t)},expression:"dialogUserQuery.post_id"}},e._l(e.hasPostsOfDepart,(function(e){return l("el-option",{key:e.post_id,attrs:{label:e.post_name,value:e.post_id}})})),1)],1),l("el-form-item",{attrs:{label:"角色"}},[l("el-select",{staticStyle:{width:"140px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.dialogUserQuery.role_id,callback:function(t){e.$set(e.dialogUserQuery,"role_id",t)},expression:"dialogUserQuery.role_id"}},e._l(e.allRoles,(function(e){return l("el-option",{key:e.role_id,attrs:{label:e.role_name,value:e.role_id}})})),1)],1),l("el-form-item",{attrs:{label:"性别"}},[l("el-select",{staticStyle:{width:"140px"},attrs:{clearable:"",placeholder:"请选择"},model:{value:e.dialogUserQuery.user_sex,callback:function(t){e.$set(e.dialogUserQuery,"user_sex",t)},expression:"dialogUserQuery.user_sex"}},[l("el-option",{attrs:{label:"男",value:"男"}}),l("el-option",{attrs:{label:"女",value:"女"}})],1)],1),l("el-form-item",{attrs:{label:"是否注册"}},[l("el-select",{staticStyle:{width:"113px"},attrs:{clearable:"",placeholder:"请选择"},model:{value:e.dialogUserQuery.reg_state,callback:function(t){e.$set(e.dialogUserQuery,"reg_state",t)},expression:"dialogUserQuery.reg_state"}},[l("el-option",{attrs:{label:"已注册",value:"1"}}),l("el-option",{attrs:{label:"未注册",value:"0"}})],1)],1),l("el-form-item",{attrs:{label:"是否在职"}},[l("el-select",{staticStyle:{width:"113px"},attrs:{clearable:"",placeholder:"请选择"},model:{value:e.dialogUserQuery.work_state,callback:function(t){e.$set(e.dialogUserQuery,"work_state",t)},expression:"dialogUserQuery.work_state"}},[l("el-option",{attrs:{label:"在职",value:"1"}}),l("el-option",{attrs:{label:"离职",value:"0"}}),l("el-option",{attrs:{label:"休长假",value:"2"}})],1)],1),l("el-form-item",{attrs:{label:"工号"}},[l("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:"工号",size:"mini"},model:{value:e.dialogUserQuery.card_num,callback:function(t){e.$set(e.dialogUserQuery,"card_num",t)},expression:"dialogUserQuery.card_num"}})],1),l("el-form-item",{attrs:{label:"姓名"}},[l("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:"姓名"},model:{value:e.dialogUserQuery.user_name,callback:function(t){e.$set(e.dialogUserQuery,"user_name",t)},expression:"dialogUserQuery.user_name"}})],1),l("el-form-item",{attrs:{label:"周期排班"}},[l("el-select",{staticStyle:{width:"113px"},attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.dialogUserQuery.schedule_id,callback:function(t){e.$set(e.dialogUserQuery,"schedule_id",t)},expression:"dialogUserQuery.schedule_id"}},e._l(e.scheduleList,(function(e){return l("el-option",{key:e.schedule_id,attrs:{label:e.schedule_name,value:e.schedule_id}})})),1)],1),l("el-form-item",[l("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dialogUserSearch(e.dialogUserQuery.depart_id)}}},[e._v("查询")])],1)],1),l("el-form",{attrs:{size:"mini",model:e.dialogMonthForm,inline:!0}},[l("el-form-item",{attrs:{label:"人员选择",rules:{required:!0,message:"人员选择不能为空",trigger:"blur"},prop:"selectedPersons"}},[l("el-transfer",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogUserLoading,expression:"dialogUserLoading"}],staticStyle:{"margin-left":"70px"},attrs:{data:e.userList,props:e.userProps,titles:["未选择人员","已选择人员"]},model:{value:e.dialogMonthForm.selectedPersons,callback:function(t){e.$set(e.dialogMonthForm,"selectedPersons",t)},expression:"dialogMonthForm.selectedPersons"}})],1),l("el-form-item",{attrs:{label:"每日排班",rules:{required:!0}}},[0===e.dialogMonthForm.dutys.length?l("el-button",{attrs:{size:"mini"},on:{click:e.monthDutyInit}},[e._v("请设置")]):l("el-button",{attrs:{size:"mini"},on:{click:e.monthDutyInit}},[e._v("已修改"+e._s(e.dialogMonthForm.dutys.length)+"天")])],1)],1),l("div",{attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{size:"mini"},on:{click:function(t){e.monthVisible=!1}}},[e._v("取 消")]),l("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.monthSubmit}},[e._v("确 定")])],1)],1),l("el-dialog",{attrs:{visible:e.monthDutyVisible,title:"修改每日排班"},on:{"update:visible":function(t){e.monthDutyVisible=t}}},[l("el-form",{attrs:{size:"mini",model:e.dialogMonthForm,"label-width":"80px"}},[l("el-form-item",{attrs:{label:"排班月份",rules:{required:!0,message:"请选择排班月份",trigger:"blur"}}},[l("el-date-picker",{staticStyle:{width:"180px"},attrs:{type:"month",placeholder:"选择排班月份",format:"yyyy年MM月","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},on:{change:e.dateChange},model:{value:e.dialogMonthForm.start_date,callback:function(t){e.$set(e.dialogMonthForm,"start_date",t)},expression:"dialogMonthForm.start_date"}})],1),l("el-form-item",{attrs:{label:"每日排班",rules:{required:!0}}},[l("span",[e._v("快捷设置班次: ")]),l("el-select",{staticStyle:{width:"130px"},attrs:{clearable:"",placeholder:"请选择"},on:{change:e.shiftChange},model:{value:e.classSelected,callback:function(t){e.classSelected=t},expression:"classSelected"}},e._l(e.classList,(function(e){return l("el-option",{key:e.class_id,attrs:{label:e.class_name,value:e.class_id}})})),1),l("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dutySetting,size:"mini","tooltip-effect":"dark",height:e.dutySetting.length>6?318:null}},[l("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),l("el-table-column",{attrs:{prop:"date",label:"日期",width:"130"}}),l("el-table-column",{attrs:{prop:"",label:"排班选择"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-select",{staticStyle:{width:"130px"},attrs:{clearable:"",placeholder:"请选择"},model:{value:t.row.value,callback:function(l){e.$set(t.row,"value",l)},expression:"scope.row.value"}},e._l(e.classList,(function(e){return l("el-option",{key:e.class_id,attrs:{label:e.class_name,value:e.class_id}})})),1)]}}])})],1)],1)],1),l("div",{attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{size:"mini"},on:{click:function(t){e.monthDutyVisible=!1}}},[e._v("取 消")]),l("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.monthDutySubmit}},[e._v("确 定")])],1)],1),l("el-dialog",{attrs:{visible:e.monthPersonVisible,title:("edit"===e.monthPersonType?"编辑":"查看")+"个人每日排班"},on:{"update:visible":function(t){e.monthPersonVisible=t}}},[l("el-form",{attrs:{size:"mini",model:e.dialogMonthForm,"label-width":"80px"}},[l("el-form-item",{attrs:{label:"姓名"}},[e._v(" "+e._s(e.monthPersonName))]),"edit"!==e.monthPersonType?l("el-form-item",{attrs:{label:"周期排班"}},[l("el-select",{staticStyle:{width:"180px"},model:{value:e.monthPersonSchedule,callback:function(t){e.monthPersonSchedule=t},expression:"monthPersonSchedule"}},e._l(e.scheduleList,(function(e){return l("el-option",{key:e.schedule_id,attrs:{disabled:"",label:e.schedule_name,value:e.schedule_id}})})),1)],1):e._e(),l("el-form-item",{attrs:{label:"排班月份",rules:{required:!0,message:"请选择排班月份",trigger:"blur"}}},[l("el-date-picker",{staticStyle:{width:"180px"},attrs:{type:"month",placeholder:"选择排班月份",format:"yyyy年MM月","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},on:{change:e.dateChange},model:{value:e.dialogMonthForm.start_date,callback:function(t){e.$set(e.dialogMonthForm,"start_date",t)},expression:"dialogMonthForm.start_date"}})],1),l("el-form-item",{attrs:{label:"每日排班",rules:{required:"edit"===e.monthPersonType}}},["edit"===e.monthPersonType?l("div",[l("span",[e._v("快捷设置班次: ")]),l("el-select",{staticStyle:{width:"130px"},attrs:{placeholder:"请选择"},on:{change:e.shiftChange},model:{value:e.classSelected,callback:function(t){e.classSelected=t},expression:"classSelected"}},e._l(e.classList,(function(e){return l("el-option",{key:e.class_id,attrs:{label:e.class_name,value:e.class_id}})})),1)],1):e._e(),l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.monthPersonLoading,expression:"monthPersonLoading"}],staticStyle:{width:"100%"},attrs:{data:e.dutySetting,size:"mini","tooltip-effect":"dark",height:e.dutySetting.length>6?316:null}},[l("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),l("el-table-column",{attrs:{prop:"date",label:"日期",width:"130"}}),"edit"!==e.monthPersonType?l("el-table-column",{key:"table-name",attrs:{prop:"name",label:"每日班次"}}):l("el-table-column",{key:"table-value",attrs:{prop:"value",label:"每日排班"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-select",{staticStyle:{width:"130px"},attrs:{disabled:"edit"!==e.monthPersonType,placeholder:"未分配"},model:{value:t.row.value,callback:function(l){e.$set(t.row,"value",l)},expression:"scope.row.value"}},e._l(e.classList,(function(e){return l("el-option",{key:e.class_name,attrs:{label:e.class_name,value:e.class_id}})})),1)]}}])})],1)],1)],1),l("div",{attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{size:"mini"},on:{click:function(t){e.monthPersonVisible=!1}}},[e._v(e._s("edit"===e.monthPersonType?"取 消":"确 定")+" ")]),"edit"===e.monthPersonType?l("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.monthDutySubmit}},[e._v("确 定")]):e._e()],1)],1)],1)])},a=[],r=(l("d3b7"),l("159b"),l("14d9"),l("ac1f"),l("00b4"),l("d81d"),l("4de4"),l("b0c0"),l("9358")),i=l("435a"),o=l("dabb");function n(e){return Object(o["a"])({url:"/attend/org/query-roles",method:"post",data:e})}var d=l("b4c9"),u=l("1a30"),c=l("92a7"),h=l("ed08"),m={data:function(){return{userQuery:{card_num:null,user_name:null,schedule_id:null,user_sex:null,depart_id:null,post_id:null,role_id:null,reg_state:null,work_state:null,page:null,size:null},loadingData:!1,departs:[],departProps:{label:"depart_name",children:"children"},current_depart:{depart_id:null,parent_id:null,depart_name:null,tag:null,level:0,is_private:0,sort:0,flag:0},hasPostsOfDepart:[],allRoles:[],scheduleList:[],multipleUsersSelection:[],current_page:1,page_rows:10,total_rows:0,query_users:[],weekVisible:!1,dialogUserQuery:{card_num:null,user_name:null,schedule_id:null,user_sex:null,depart_id:null,post_id:null,role_id:null,reg_state:null,work_state:null,page:null,size:null},departCascaderProps:{value:"depart_id",label:"depart_name",children:"children"},selectDeparts:[],userList:[],userProps:{key:"user_id",label:"user_name"},dialogUserLoading:!0,dialogWeekForm:{user_ids:[],schedule_id:null},weekPersonVisible:!1,weekPersonName:null,monthVisible:!1,dialogMonthForm:{selectedPersons:[],start_date:null,dutys:[]},monthDutyVisible:!1,pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()}},classList:[],dutySetting:[],classSelected:null,monthPersonType:"edit",monthPersonVisible:!1,monthPersonLoading:!1,monthPersonName:null,monthPersonSchedule:null}},computed:{genFullDeparts:function(){var e=this,t=[];return null==this.departs||this.departs.length<=0||this.departs.forEach((function(l){if(null==l.parent_id){var s={};s.depart_id=l.depart_id,s.depart_name=l.depart_name,s.children=e.genChildrenDeparts(l.depart_id),t.push(s)}})),t}},created:function(){this.getAllDepart(),this.getAllRole(),this.getUsersByDepartId(null),this.getAllSchedule(),this.getAllClass()},methods:{tableHeadClassName:function(){return"table-head"},tableRowClassName:function(e){e.row;var t=e.rowIndex;return t%2==0?"success-row":"warning-row"},getAllDepart:function(){var e=this;this.departs=[],Object(r["a"])({}).then((function(t){5e3===t.result_code?e.departs=t.content.departs:e.$message.error(t.result_desc)}))},getAllPostsByDepart:function(e){var t=this;this.hasPostsOfDepart=[],Object(i["a"])({depart_id:e}).then((function(e){5e3===e.result_code?t.hasPostsOfDepart=e.content.posts:t.$message.error(e.result_desc)}))},genChildrenDeparts:function(e){var t=this,l=[];return null==this.departs||this.departs.length<=0||this.departs.forEach((function(s){if(e===s.parent_id){var a={};a.depart_id=s.depart_id,a.depart_name=s.depart_name,a.children=t.genChildrenDeparts(s.depart_id),l.push(a)}})),l},getAllRole:function(){var e=this;this.allRoles=[],n({}).then((function(t){5e3===t.result_code?e.allRoles=t.content.content:e.$message.error(t.result_desc)}))},resetQuery:function(){this.resetForm("userQuery"),this.handleQuery()},getAllSchedule:function(){var e=this;this.scheduleList=[],Object(c["b"])({schedule_name:null,page:-1,size:10}).then((function(t){5e3===t.result_code?e.scheduleList=t.content.content:e.$message.error(t.result_desc)}))},getAllClass:function(){var e=this;this.classList=[],Object(d["c"])({att_cla_name:null,page:0,size:1e3}).then((function(t){5e3===t.result_code?t.content.content&&t.content.content.length>0&&t.content.content.forEach((function(t){e.classList.push({class_id:t.att_cla_id,class_name:t.att_cla_name,attend_time:t.claCloDtosList,total_hours:t.att_cla_totalHours,is_elastic:t.att_cla_isElastic})})):e.$message.error(t.result_desc)}))},handleNodeClick:function(e){this.current_depart=e,this.getAllPostsByDepart(this.current_depart.depart_id),this.getUsersByDepartId(this.current_depart.depart_id)},getUsersByDepartId:function(e){var t=this;this.userQuery.page=this.current_page-1,this.userQuery.size=this.page_rows,this.userQuery.depart_id=e,this.query_users=[],this.loadingData=!0,Object(u["a"])(this.userQuery).then((function(e){if(5e3===e.result_code){var l=e.content.users;t.query_users=l.content,t.total_rows=l.totalElements}else t.$message.error(e.result_desc);t.loadingData=!1})).catch((function(){return t.loadingData=!1}))},handleCurrentChange:function(e){var t=/^[0-9]+.?[0-9]*$/;if(t.test(e))if(e<=0)this.$message.error("页面不能小于1");else{var l=parseInt(this.total_rows/this.page_rows);this.total_rows%this.page_rows!=0&&(l+=1),e>l?this.$message.error("页面不能大于"+l):(this.current_page=e,this.getUsersByDepartId(this.current_depart.depart_id))}else this.$message.error("请输入数字")},handleSizeChange:function(e){this.page_rows=e,this.getUsersByDepartId(this.current_depart.depart_id)},isWorking:function(e){return 0===e||"0"===e?"离职":1===e||"1"===e?"在职":2===e||"2"===e?"长休假":e},handleSelectionChange:function(e){this.multipleUsersSelection=e},weekInit:function(){this.weekVisible=!0,this.dialogWeekForm={user_ids:[],schedule_id:null},this.dialogUserSearch(null)},weekDepartChange:function(e){null!=e&&(this.dialogUserQuery.depart_id=e[e.length-1],this.getAllPostsByDepart(e[e.length-1]))},dialogUserSearch:function(e){var t=this;this.dialogUserQuery.page=-1,this.dialogUserQuery.size=1e3,this.dialogUserQuery.depart_id=e,this.userList=[],this.dialogUserLoading=!0,Object(u["b"])(this.userQuery).then((function(e){5e3===e.result_code?t.userList=e.content.users:t.$message.error(e.result_desc),t.dialogUserLoading=!1})).catch((function(){return t.dialogUserLoading=!1}))},weekSubmit:function(){var e=this;this.dialogWeekForm.user_ids&&0!==this.dialogWeekForm.user_ids.length?this.dialogWeekForm.schedule_id?(Object(c["f"])(this.dialogWeekForm).then((function(t){5e3===t.result_code?(e.$message({message:"修改周期排班成功",type:"success"}),e.getUsersByDepartId(e.current_depart.depart_id),e.weekVisible=!1,e.weekPersonVisible=!1):e.$message.error(t.result_desc)})),console.log(this.dialogWeekForm)):this.$message.error("请选择排班周期"):this.$message.error("人员选择不能为空")},weekPersonInit:function(e){this.weekPersonVisible=!0,this.weekPersonName=e.user_name,this.dialogWeekForm={user_ids:[e.user_id],schedule_id:e.schedule_id}},monthInit:function(){this.monthVisible=!0;var e=new Date;this.dialogMonthForm={selectedPersons:[],start_date:e.getFullYear()+"-"+(e.getMonth()<9?"0":"")+(e.getMonth()+1)+"-01",dutys:[]},this.dialogUserSearch(null)},monthSubmit:function(){var e=this;if(this.dialogMonthForm.selectedPersons&&0!==this.dialogMonthForm.selectedPersons.length)if(this.dialogMonthForm.dutys&&0!==this.dialogMonthForm.dutys.length){var t={user_ids:this.dialogMonthForm.selectedPersons,classes:this.dialogMonthForm.dutys.map((function(e){return{id:e.user_cla_id||null,att_cla_id:e.value,date:new Date(e.date)}}))};Object(c["g"])(t).then((function(t){5e3===t.result_code?(e.$message({message:"批量修改每日排班成功",type:"success"}),e.getUsersByDepartId(e.current_depart.depart_id),e.monthVisible=!1):e.$message.error(t.result_desc)}))}else this.$message.error("请修改每日排班");else this.$message.error("人员选择不能为空")},monthDutyInit:function(){var e=this;if(this.monthPersonType="edit",this.monthDutyVisible=!0,this.classSelected=null,this.dateChange(),this.dialogMonthForm.dutys.length>0){var t=this.dialogMonthForm.dutys.map((function(e){return e.date}));this.dutySetting.forEach((function(l){t.indexOf(l.date)>-1&&(l.value=e.dialogMonthForm.dutys[t.indexOf(l.date)].value)}))}},dateChange:function(){var e=new Date(this.dialogMonthForm.start_date);e.setMonth(e.getMonth()+1),e.setDate(e.getDate()-1);var t=e.getDate(),l=e.getMonth()>(new Date).getMonth()?1:(new Date).getDate();this.dutySetting=[];for(var s="edit"===this.monthPersonType?l:1;s<=t;s++)this.dutySetting.push({date:this.dialogMonthForm.start_date.substring(0,8)+(s<10?"0":"")+s,value:null,name:""});("edit"!==this.monthPersonType||this.monthPersonVisible)&&this.monthDutyGet()},monthDutySubmit:function(){var e=this;if(this.dialogMonthForm.start_date)if(0!==this.dutySetting.length&&0!==this.dutySetting.filter((function(e){return null!==e.value&&""!==e.value})).length)if(this.dialogMonthForm.dutys=this.dutySetting.filter((function(e){return null!==e.value&&""!==e.value})).map((function(e){return e})),this.monthPersonVisible){var t={user_ids:this.dialogMonthForm.selectedPersons,classes:this.dialogMonthForm.dutys.map((function(e){return{id:e.user_cla_id||null,att_cla_id:e.value,date:new Date(e.date)}}))};Object(c["g"])(t).then((function(t){5e3===t.result_code?(e.$message({message:"修改每日排班成功",type:"success"}),e.getUsersByDepartId(e.current_depart.depart_id),e.monthPersonVisible=!1):e.$message.error(t.result_desc)}))}else this.monthDutyVisible=!1;else this.$message.error("至少设置一天的排班");else this.$message.error("请选择排班月份")},shiftChange:function(e){this.dutySetting.forEach((function(t){t.value=e}))},monthDutyGet:function(){var e=this;this.monthPersonLoading=!0,Object(c["c"])({user_id:this.dialogMonthForm.selectedPersons[0],date:new Date(this.dialogMonthForm.start_date)}).then((function(t){if(5e3===t.result_code){var l=t.content;l.forEach((function(e){e.date=Object(h["i"])(e.date).substring(0,10)}));var s=l.map((function(e){return e.date}));e.dutySetting.forEach((function(e){s.indexOf(e.date)>-1&&(e.value=l[s.indexOf(e.date)].att_cla_id,e.name=l[s.indexOf(e.date)].att_cla_name)}))}else e.$message.error(t.result_desc);e.monthPersonLoading=!1})).catch((function(){e.monthPersonLoading=!1}))},monthPersonInit:function(e,t){var l=this;this.monthPersonType=t,this.classSelected=null;var s=new Date;if(this.monthPersonVisible=!0,this.monthPersonName=e.user_name,this.dialogMonthForm={selectedPersons:[e.user_id],start_date:s.getFullYear()+"-"+(s.getMonth()<9?"0":"")+(s.getMonth()+1)+"-01",dutys:[]},this.dateChange(),this.dialogMonthForm.dutys.length>0){var a=this.dialogMonthForm.dutys.map((function(e){return e.date}));this.dutySetting.forEach((function(e){a.indexOf(e.date)>-1&&(e.value=l.dialogMonthForm.dutys[a.indexOf(e.date)].value)}))}"edit"!==this.monthPersonType&&(this.monthPersonSchedule=e.schedule_id)}}},p=m,g=(l("6820"),l("2877")),_=Object(g["a"])(p,s,a,!1,null,"157705d2",null);t["default"]=_.exports}}]);