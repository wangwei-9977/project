(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0d1580f8"],{"41a8":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return l})),n.d(t,"a",(function(){return u}));var a=n("dabb");function r(){return Object(a["a"])({url:"/attend/state/attend-state",method:"get",params:{}})}function o(e){return Object(a["a"])({url:"/attend/schedule/query-daily-data",method:"post",data:e})}function s(e){return Object(a["a"])({url:"/attend/schedule/query-duty-data",method:"post",data:e})}function l(e){return Object(a["a"])({url:"/attend/duty/query-month-data",method:"post",data:e})}function u(e){return Object(a["a"])({url:"/attend/duty/export-excel",method:"post",data:e,responseType:"blob"})}},"435a":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("dabb");function r(e){return Object(a["a"])({url:"/attend/org/find-posts-by-depart",method:"post",data:e})}},5212:function(e,t,n){},"544a":function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s}));var a=n("dabb");function r(e){return Object(a["a"])({url:"/attend/clock/create",method:"post",data:e})}function o(e){return Object(a["a"])({url:"/attend/my/query-clocks",method:"post",data:e})}function s(e){return Object(a["a"])({url:"/attend/clock/del",method:"post",data:e})}},"830b":function(e,t,n){"use strict";n("5212")},9358:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("dabb");function r(e){return Object(a["a"])({url:"/attend/org/query-full-departs",method:"post",data:e})}},cff7:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"depart-list"},[n("div",[n("el-tree",{attrs:{data:e.genFullDeparts,props:e.departProps,"highlight-current":!0,accordion:""},on:{"node-click":e.handleNodeClick}})],1)]),n("div",{staticClass:"depart-detail"},[n("div",{staticClass:"query-box"},[n("el-form",{attrs:{inline:!0,model:e.userQuery,size:"mini"}},[n("el-form-item",{attrs:{label:"姓名"}},[n("el-input",{attrs:{placeholder:"姓名"},model:{value:e.userQuery.us_name,callback:function(t){e.$set(e.userQuery,"us_name",t)},expression:"userQuery.us_name"}})],1),n("el-form-item",{attrs:{label:"考勤时间"}},[n("el-date-picker",{staticStyle:{width:"150px"},attrs:{type:"date",placeholder:"选择日期"},model:{value:e.userQuery.attend_date,callback:function(t){e.$set(e.userQuery,"attend_date",t)},expression:"userQuery.attend_date"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:function(t){return e.getDailyDatas(e.current_depart.depart_id)}}},[e._v("搜索")])],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-export",size:"mini"},on:{click:function(t){return e.export_excel()}}},[e._v("导出")])],1)],1)],1),n("div",{staticClass:"content-box"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingData,expression:"loadingData"}],attrs:{data:e.query_users,"header-cell-class-name":e.tableHeadClassName,"cell-class-name":e.tableRowClassName}},[n("el-table-column",{attrs:{label:"日期",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDate(t.row.date))+" ")]}}])}),n("el-table-column",{attrs:{prop:"week",label:"星期",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatWeek(t.row.date))+" ")]}}])}),n("el-table-column",{attrs:{prop:"user_name",label:"姓名",align:"center"}}),n("el-table-column",{attrs:{prop:"depart_name",label:"部门",align:"center"}}),n("el-table-column",{attrs:{prop:"post_name",label:"岗位",align:"center"}}),e._l(e.onAndOffClocks,(function(t){return n("el-table-column",{key:t.clo_name,attrs:{label:t.clo_name,width:"120px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.inExistClock(a.row,t)?n("div",[n("el-tag",{attrs:{type:e.attendType(a.row,t),"disable-transitions":""}},[e._v(e._s(e.calClockAttendState(a.row,t)))])],1):n("div",[e._v("/")])]}}],null,!0)})}))],2),n("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total_rows>0,expression:"total_rows > 0"}],attrs:{total:e.total_rows,page:e.current_page,limit:e.page_rows},on:{"update:page":function(t){e.current_page=t},"update:limit":function(t){e.page_rows=t},pagination:function(t){return e.getDailyDatas(e.current_depart.depart_id)}}})],1)])])},r=[],o=(n("d3b7"),n("159b"),n("14d9"),n("3ca3"),n("ddb0"),n("2b3d"),n("9861"),n("9358")),s=n("435a"),l=n("544a"),u=n("41a8"),i=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],c={data:function(){return{current_depart:{depart_id:null,parent_id:null,depart_name:null,tag:null,level:0,is_private:0,sort:0,flag:0},userQuery:{user_card_num:null,terminal_name:null,us_name:null,dep_id:null,post_id:null,clo_id:null,clo_name:null,attent_states:null,attend_date:null,page:null,size:null,depart_id:null},loadingData:!1,selectDeparts:[],departs:[],departProps:{label:"depart_name",children:"children"},current_page:1,page_rows:10,total_rows:0,query_users:[],hasPostsOfDepart:[],defaultDate:[new Date(2019,3,12,1,1),new Date(2019,3,12,12,12)],all_clocks:[],onAndOffClocks:[],all_attend_state:[]}},computed:{genFullDeparts:function(){var e=this,t=[];return null==this.departs||this.departs.length<=0||this.departs.forEach((function(n){if(null==n.parent_id){var a={};a.depart_id=n.depart_id,a.depart_name=n.depart_name,a.children=e.genChildrenDeparts(n.depart_id),t.push(a)}})),t}},created:function(){this.getAllDepart(),this.getAllClocks(),this.getAllAttendState(),this.getDailyDatas(this.current_depart.depart_id)},methods:{tableHeadClassName:function(){return"table-head"},tableRowClassName:function(e){e.row;var t=e.rowIndex;return t%2==0?"success-row":"warning-row"},getAllRole:function(){var e=this;this.allRoles=[],getRoles({}).then((function(t){5e3===t.result_code?e.allRoles=t.content.content:e.$message.error(t.result_desc)}))},genChildrenDeparts:function(e){var t=this,n=[];return null==this.departs||this.departs.length<=0||this.departs.forEach((function(a){if(e===a.parent_id){var r={};r.depart_id=a.depart_id,r.depart_name=a.depart_name,r.children=t.genChildrenDeparts(a.depart_id),n.push(r)}})),n},export_excel:function(){var e=this;this.userQuery.dep_id=this.userQuery.depart_id,this.loadingData=!0,Object(u["a"])(this.userQuery).then((function(e){var t=document.createElement("a"),n=new Blob([e],{type:"application/vnd.ms-excel"});t.href=URL.createObjectURL(n),console.log(t.href),t.style.display="none",t.download="考勤日报.xlsx",t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)})).catch((function(t){e.$message.error(t)}))},getAllDepart:function(){var e=this;Object(o["a"])({}).then((function(t){if(5e3===t.result_code){var n=t.content;e.departs=n.departs}else e.$message.error(t.result_desc)}))},getAllClocks:function(){var e=this;this.onAndOffClocks=[];var t={page:-1};Object(l["b"])(t).then((function(t){5e3===t.result_code?(e.all_clocks=t.content.content,e.all_clocks.forEach((function(t){var n={};n.clo_id=t.clo_id,n.clo_name=t.clo_name+"上班",n.state="on",e.onAndOffClocks.push(n);var a={};a.clo_id=t.clo_id,a.clo_name=t.clo_name+"下班",a.state="off",e.onAndOffClocks.push(a)}))):e.$message.error(t.result_desc)}))},getAllAttendState:function(){var e=this;Object(u["b"])().then((function(t){5e3===t.result_code?e.all_attend_state=t.content:e.$message.error(t.result_desc)}))},clearUserQuery:function(){this.userQuery.user_card_num=null,this.userQuery.terminal_name=null,this.userQuery.us_name=null,this.userQuery.depart_id=null,this.userQuery.post_id=null,this.userQuery.clo_id=null,this.userQuery.clo_name=null,this.userQuery.attent_states=null,this.userQuery.start_time=null,this.userQuery.end_time=null,this.userQuery.page=null,this.userQuery.size=null},handleNodeClick:function(e){this.current_depart=e,this.getAllPostsByDepart(this.current_depart.depart_id),this.getDailyDatas(this.current_depart.depart_id)},getDailyDatas:function(e){var t=this;this.userQuery.dep_id=e,this.userQuery.page=this.current_page-1,this.userQuery.size=this.page_rows,this.loadingData=!0,this.query_users=[],Object(u["c"])(this.userQuery).then((function(e){5e3===e.result_code?(t.query_users=e.content.content,t.total_rows=e.content.totalElements):t.$message.error(e.result_desc),t.loadingData=!1})).catch((function(){return t.loadingData=!1}))},getAllPostsByDepart:function(e){var t=this;Object(s["a"])({depart_id:e}).then((function(e){5e3===e.result_code?t.hasPostsOfDepart=e.content.posts:t.$message.error(e.result_desc)}))},formatDate:function(e){var t=new Date(e),n=t.getMonth()+1;n=n<10?"0"+n:n;var a=t.getDate();return a=a<10?"0"+a:a,t.getFullYear()+"-"+n+"-"+a},formatWeek:function(e){var t=new Date(e);return i[t.getDay()]},formatTime:function(e){var t=new Date(e),n=t.getHours();n=n<10?"0"+n:n;var a=t.getMinutes();a=a<10?"0"+a:a;var r=t.getSeconds();return r=r<10?"0"+r:r,n+":"+a+":"+r},inExistClock:function(e,t){var n=!1;return e.clockList.forEach((function(e){if(e.clock_id===t.clo_id&&("on"===t.state&&null!==e.onWorkAttendState&&"无"!==e.onWorkAttendState||"off"===t.state&&null!==e.offWorkAttendState&&"无"!==e.offWorkAttendState))return n=!0,n})),n},attendType:function(e,t){var n="danger";return e.clockList.forEach((function(e){e.clock_id===t.clo_id&&("on"===t.state?"缺勤"!==e.onWorkAttendState&&(n="迟到"===e.onWorkAttendState?"warning":"早退"===e.onWorkAttendState?"primary":"success"):"缺勤"!==e.offWorkAttendState&&(n="迟到"===e.offWorkAttendState?"warning":"早退"===e.offWorkAttendState?"primary":"success"))})),n},calClockAttendState:function(e,t){var n=this,a="缺勤";return e.clockList.forEach((function(e){e.clock_id===t.clo_id&&("on"===t.state?null==e.onWorkAttendState?a="/":"缺勤"!==e.onWorkAttendState&&(a=n.formatTime(e.onWorkDate)):null==e.offWorkAttendState?a="/":"缺勤"!==e.offWorkAttendState&&(a=n.formatTime(e.offWorkDate)))})),a},handleSizeChange:function(e){this.page_rows=e},handleCurrentChange:function(e){this.current_page=e,this.getDailyDatas(this.current_depart.depart_id)},handleChange:function(e){},departSelecedChange:function(e){null!=e&&(this.userQuery.depart_id=e[e.length-1],this.getAllPostsByDepart(e[e.length-1]))},clockChange:function(e){this.userQuery.clo_id=e.clo_id,this.userQuery.clo_name=e.clo_name}}},d=c,p=(n("830b"),n("2877")),f=Object(p["a"])(d,a,r,!1,null,"41ebfa58",null);t["default"]=f.exports},dabb:function(e,t,n){"use strict";n("d3b7");var a=n("bc3a"),r=n.n(a),o=n("5c96"),s=n("4360"),l=n("5f87");r.a.defaults.headers["Content-Type"]="application/json;charset=utf-8";var u=r.a.create({baseURL:"http://172.20.112.56:9001",timeout:3e4});function i(e){return{request_source:"",verify_code:"",request_time:(new Date).getTime(),token:s["a"].getters.token?Object(l["a"])():"",content:e}}u.interceptors.request.use((function(e){return s["a"].getters.token&&(e.headers["X-Token"]=Object(l["a"])()),"post"===e.method&&(e.type||(e.data=i(e.data)),console.log(e.data)),e}),(function(e){console.log(e),Promise.reject(e)})),u.interceptors.response.use((function(e){var t=e.data;return 5e3!==t.result_code?(Object(o["Message"])({message:t.result_desc,type:"error",duration:5e3}),5008!==t.result_code&&5012!==t.result_code&&5014!==t.result_code||o["MessageBox"].confirm("你已被登出，可以取消继续留在该页面，或者重新登录","确定登出",{confirmButtonText:"重新登录",cancelButtonText:"取消",type:"warning"}).then((function(){s["a"].dispatch("FedLogOut").then((function(){location.reload()}))})),Promise.reject("error")):e.data}),(function(e){return console.log("err"+e),Object(o["Message"])({message:"发生未知错误,请联系管理员.",type:"error",duration:5e3}),Promise.reject(e)})),t["a"]=u}}]);