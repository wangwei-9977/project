(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7bc0af90"],{"04d1":function(e,t,s){var i=s("342f"),l=i.match(/firefox\/(\d+)/i);e.exports=!!l&&+l[1]},"218e":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"schedule",attrs:{size:"mini",model:e.query_schedule,inline:!0,"label-width":"68px"}},[s("el-form-item",{staticClass:"query-item",attrs:{label:"排班名称",prop:"schedule_name"}},[s("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入排班名称"},model:{value:e.query_schedule.schedule_name,callback:function(t){e.$set(e.query_schedule,"schedule_name",t)},expression:"query_schedule.schedule_name"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.search}},[e._v("搜索")]),s("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),s("el-row",{staticClass:"mb8",attrs:{gutter:10}},[s("el-col",{attrs:{span:1.5}},[s("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["attendance:schedule:add"],expression:"['attendance:schedule:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:e.addSchedule}},[e._v("新增")])],1),s("el-col",{attrs:{span:1.5}},[s("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["attendance:schedule:edit"],expression:"['attendance:schedule:edit']"}],attrs:{type:"success",plain:"",icon:"el-icon-edit",size:"mini"},on:{click:e.editSchedule}},[e._v("修改")])],1),s("el-col",{attrs:{span:1.5}},[s("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["attendance:schedule:remove"],expression:"['attendance:schedule:remove']"}],attrs:{type:"danger",plain:"",icon:"el-icon-delete",size:"mini"},on:{click:e.scheduleDelete}},[e._v("删除")])],1),s("right-toolbar",{attrs:{showSearch:e.showSearch},on:{"update:showSearch":function(t){e.showSearch=t},"update:show-search":function(t){e.showSearch=t},queryTable:e.search}})],1),s("el-table",{attrs:{data:e.schedules,"header-cell-class-name":e.tableHeadClassName,"cell-class-name":e.tableRowClassName}},[s("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),s("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),s("el-table-column",{attrs:{prop:"schedule_name",label:"排班名称",align:"center"}}),s("el-table-column",{attrs:{prop:"loop_time",label:"周期天数",align:"center"}}),s("el-table-column",{attrs:{prop:"start_date",label:"开始时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.transformDate(t.row.start_date))+" ")]}}])}),s("el-table-column",{attrs:{prop:"start_date",label:"混合模板",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:1===t.row.is_blend?"primary":"warning","disable-transitions":""}},[e._v(" "+e._s(t.row.is_blend?"是":"否")+" ")])]}}])}),s("el-table-column",{attrs:{prop:"option",label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["attendance:schedule:edit"],expression:"['attendance:schedule:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(s){return e.editSchedule(t.row)}}},[e._v("修改")]),s("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["attendance:schedule:remove"],expression:"['attendance:schedule:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(s){return e.scheduleDelete(t.row)}}},[e._v("删除")])]}}])})],1),s("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total_rows>0,expression:"total_rows > 0"}],attrs:{total:e.total_rows,page:e.current_page,limit:e.page_rows},on:{"update:page":function(t){e.current_page=t},"update:limit":function(t){e.page_rows=t},pagination:e.search}}),s("el-dialog",{attrs:{visible:e.saveScheduleVisible,title:"设置周期排班"},on:{"update:visible":function(t){e.saveScheduleVisible=t}}},[s("el-form",{attrs:{model:e.form,"label-width":"120px",size:"mini"}},[s("el-form-item",{attrs:{prop:"schedule_name",label:"排班名称:"}},[s("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入排班名称",size:"small"},model:{value:e.form.schedule_name,callback:function(t){e.$set(e.form,"schedule_name",t)},expression:"form.schedule_name"}})],1),s("el-form-item",{attrs:{prop:"user_ids",label:"参与考勤人员:"}},[s("el-button",{attrs:{plain:"",size:"small"},on:{click:e.dutyPersonInit}},[e._v(" "+e._s(this.form.user_ids.length>0?this.form.user_ids.length+"人":"请选择")+" ")])],1),s("el-form-item",{attrs:{label:"开始日期:",prop:"start_date"}},[s("el-date-picker",{staticStyle:{width:"180px"},attrs:{"picker-options":e.pickerOptions,type:"datetime",size:"small",format:"yyyy-MM-dd HH:mm","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间",align:"right"},model:{value:e.form.start_date,callback:function(t){e.$set(e.form,"start_date",t)},expression:"form.start_date"}})],1),s("el-form-item",{attrs:{label:"编辑模式:"}},[s("div",[s("el-radio",{attrs:{label:"1"},on:{change:e.editTypeChange},model:{value:e.editType,callback:function(t){e.editType=t},expression:"editType"}},[e._v("固定班制(每天考勤一样)")])],1),s("div",{staticStyle:{"margin-top":"20px"}},[s("el-radio",{attrs:{label:"2"},on:{change:e.editTypeChange},model:{value:e.editType,callback:function(t){e.editType=t},expression:"editType"}},[e._v("排班制(自定义设置考勤时间)")])],1),s("div",{staticStyle:{"margin-top":"20px"}},[s("el-radio",{attrs:{label:"3"},on:{change:e.editTypeChange},model:{value:e.editType,callback:function(t){e.editType=t},expression:"editType"}},[e._v("混合排班(按现有排班进行二次排班)")])],1)]),"1"===e.editType?s("el-form-item",{attrs:{label:"工作日设置:"}},[s("span",[e._v("快捷设置班次: 休息")]),s("el-button",{attrs:{type:"text",size:"mini"},on:{click:e.dutyWeekInit}},[e._v("更改班次")]),s("el-table",{ref:"workTable",staticStyle:{width:"100%"},attrs:{data:e.work_classes,"tooltip-effect":"dark"},on:{"selection-change":e.dutyWeekCheckChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{prop:"class_name",label:"工作日",width:"120",align:"center"}}),s("el-table-column",{attrs:{prop:"attend_time",label:"工作时间段",align:"center"}}),s("el-table-column",{attrs:{prop:"option",label:"操作",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){return e.dutyWeekInit(t.row)}}},[e._v("更改班次")]),s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){return e.dutyWeekclear(t.row)}}},[e._v("删除班次")])]}}],null,!1,3551929790)})],1)],1):e._e(),"2"===e.editType?s("el-form-item",{attrs:{label:"考勤班次"}},[e.dutyCycleShifts.length<=0?s("el-button",{attrs:{plain:"",size:"mini"},on:{click:e.dutyCycleShiftInit}},[e._v("选择班次 ")]):e._e(),e.dutyCycleShifts.length>0?s("el-button",{staticStyle:{"max-width":"100%","text-align":"left"},attrs:{plain:"",size:"mini"},on:{click:e.dutyCycleShiftInit}},e._l(e.dutyCycleShifts,(function(t,i){return s("span",{key:i},[s("el-tag",{staticStyle:{"margin-right":"5px","margin-bottom":"5px"},attrs:{size:"mini",type:e.tagType[i%4],"disable-transitions":!1,closable:""},on:{close:function(s){return e.closeTag(t)}}},[e._v(" "+e._s(t.class_name)+" ")]),(i+1)%4===0?s("br"):e._e()],1)})),0):e._e()],1):e._e(),"2"===e.editType&&e.dutyCycleShifts&&e.dutyCycleShifts.length>0?s("el-form-item",{attrs:{label:"排班周期:"}},[!e.dutyCycles||e.dutyCycles.length<=0?s("el-button",{attrs:{plain:"",size:"mini"},on:{click:e.dutyCycleInit}},[e._v("请设置排班周期 ")]):s("div",[s("el-table",{staticStyle:{width:"100%"},attrs:{size:"mini",data:e.dutyCycles,"tooltip-effect":"dark"}},[s("el-table-column",{attrs:{label:"周期班次",prop:"valueStr"}}),s("el-table-column",{attrs:{label:"周期天数",prop:"loop_time"}}),s("el-table-column",{attrs:{prop:"option",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){return e.dutyCycleInit(t.row)}}},[e._v("设置")])]}}],null,!1,200620667)})],1)],1)],1):e._e(),"3"===e.editType?s("el-form-item",{attrs:{label:"月份设置:"}},[s("span",[e._v("快捷设置排班: 休息")]),s("el-button",{attrs:{type:"text",size:"mini"},on:{click:e.monthScheduleInit}},[e._v("更改排班")]),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.month_schedules,size:"mini","tooltip-effect":"dark"},on:{"selection-change":e.handleSecheduleChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{prop:"schedule_month",label:"月份",width:"120"}}),s("el-table-column",{attrs:{prop:"schedule_name",label:"排班类型"}}),s("el-table-column",{attrs:{prop:"option",label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){return e.monthScheduleInit(t.row)}}},[e._v("更改排班")])]}}],null,!1,179649536)})],1)],1):e._e(),s("el-form-item",{attrs:{label:""}},[s("el-checkbox",{on:{change:e.holidayChange},model:{value:e.holidayStatus,callback:function(t){e.holidayStatus=t},expression:"holidayStatus"}},[e._v("法定节假日自动排休")])],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.saveSchedule}},[e._v("保存设置")]),s("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.goback}},[e._v("返回")])],1)],1)],1),s("el-dialog",{attrs:{visible:e.dutyPersonVisible,title:"参与考勤人员",width:"50%"},on:{"update:visible":function(t){e.dutyPersonVisible=t}}},[s("el-form",{attrs:{model:e.dutyPersonQuery,inline:!0,size:"small","label-width":"70px"}},[s("el-form-item",{attrs:{label:"部门"}},[s("el-cascader",{staticStyle:{width:"180px"},attrs:{value:e.selectDeparts,options:e.genFullDeparts,props:e.departCascaderProps,placeholder:"试试搜索：部门",filterable:"","change-on-select":""},on:{change:e.departSelecedChange}})],1),s("el-form-item",{attrs:{label:"姓名"}},[s("el-input",{staticStyle:{width:"180px"},attrs:{clearable:"","auto-complete":"off"},model:{value:e.dutyPersonQuery.userName,callback:function(t){e.$set(e.dutyPersonQuery,"userName",t)},expression:"dutyPersonQuery.userName"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:e.dutyPersonGet}},[e._v("查询")])],1)],1),s("el-transfer",{directives:[{name:"loading",rawName:"v-loading",value:e.dutyPersonLoading,expression:"dutyPersonLoading"}],attrs:{data:e.query_users,props:e.userProps,titles:["未分配人员","已分配人员"],filterable:""},model:{value:e.selectedPersons,callback:function(t){e.selectedPersons=t},expression:"selectedPersons"}}),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dutyPersonVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.dutyPersonSubmit}},[e._v("确 定")])],1)],1),s("el-dialog",{attrs:{visible:e.dutyWeekVisible,title:"选择班次"},on:{"update:visible":function(t){e.dutyWeekVisible=t}}},[s("el-form",{attrs:{model:e.dutyWeekQuery,inline:!0,"label-width":"120px"}},[s("el-form-item",{staticStyle:{float:"right"}},[s("el-input",{attrs:{size:"mini",placeholder:"请输入班次名称"},model:{value:e.dutyWeekQuery.name,callback:function(t){e.$set(e.dutyWeekQuery,"name",t)},expression:"dutyWeekQuery.name"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.dutyWeekSearch},slot:"suffix"})])],1)],1),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dutyWeekShifts,"tooltip-effect":"dark",size:"mini",height:"298"}},[s("el-table-column",{attrs:{label:"",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-radio",{attrs:{label:t.row.class_id},nativeOn:{change:function(s){return e.dutyWeekChange(t.$index,t.row)}},model:{value:e.dutyWeekType,callback:function(t){e.dutyWeekType=t},expression:"dutyWeekType"}})]}}])}),s("el-table-column",{attrs:{prop:"class_name",label:"班次名称",width:"120"}}),s("el-table-column",{attrs:{prop:"total_hours",label:"总工时",width:"120"}}),s("el-table-column",{attrs:{prop:"is_elastic",label:"是否弹性"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:1===t.row.is_elastic?"primary":"warning","disable-transitions":""}},[e._v(" "+e._s(e.isElastic(t.row.is_elastic))+" ")])]}}])})],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dutyWeekVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.dutyWeekSubmit}},[e._v("确 定")])],1)],1),s("el-dialog",{attrs:{visible:e.dutyCycleShiftVisible,title:"选择班次"},on:{"update:visible":function(t){e.dutyCycleShiftVisible=t}}},[s("el-form",{attrs:{model:e.dutyCycleShiftQuery,inline:!0,"label-width":"120px"}},[s("el-form-item",{staticStyle:{float:"right"}},[s("el-input",{attrs:{size:"medium",placeholder:"请输入班次名称"},model:{value:e.dutyCycleShiftQuery.att_cla_name,callback:function(t){e.$set(e.dutyCycleShiftQuery,"att_cla_name",t)},expression:"dutyCycleShiftQuery.att_cla_name"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.dutyCycleShiftSearch},slot:"suffix"})])],1)],1),s("el-table",{ref:"multipleClassesTable",staticStyle:{width:"100%"},attrs:{size:"mini",data:e.dutyCycleShiftLists,"tooltip-effect":"dark",height:"298"},on:{"selection-change":e.handleSelClassChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{prop:"class_name",label:"班次名称",width:"120"}}),s("el-table-column",{attrs:{prop:"total_hours",label:"总工时",width:"120"}}),s("el-table-column",{attrs:{prop:"is_elastic",label:"是否弹性"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:1===t.row.is_elastic?"primary":"warning","disable-transitions":""}},[e._v(" "+e._s(e.isElastic(t.row.is_elastic))+" ")])]}}])})],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dutyCycleShiftVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.dutyCycleShiftSubmit}},[e._v("确 定")])],1)],1),s("el-dialog",{attrs:{visible:e.dutyCycleVisible,title:"设置排班周期"},on:{"update:visible":function(t){e.dutyCycleVisible=t}}},[s("el-form",{attrs:{model:e.dutyCycleSetting,size:"mini","label-width":"120px"}},[s("el-form-item",{attrs:{label:"每个周期天数:",rules:{required:!0,message:"请输入周期天数",trigger:"change"},prop:"loop_time"}},[s("el-input-number",{attrs:{min:2,max:31,"controls-position":"right"},on:{change:e.handleChange},model:{value:e.dutyCycleSetting.loop_time,callback:function(t){e.$set(e.dutyCycleSetting,"loop_time",t)},expression:"dutyCycleSetting.loop_time"}}),s("span",[e._v("以"+e._s(e.dutyCycleSetting.loop_time)+"天为周期进行循环，最大周期天数为31天")])],1),e._l(e.dutyCycleSetting.loop_time,(function(t){return s("el-form-item",{key:t,attrs:{label:"第"+t+"天:"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:e.dutyCycleSetting.values[t-1],callback:function(s){e.$set(e.dutyCycleSetting.values,t-1,s)},expression:"dutyCycleSetting.values[item - 1]"}},e._l(e.dutyCycleShifts,(function(e){return s("el-option",{key:e.class_id,attrs:{label:e.class_name,value:e.class_id}})})),1)],1)}))],2),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dutyCycleVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.dutyCycleSubmit}},[e._v("确 定")])],1)],1),s("el-dialog",{attrs:{visible:e.monthScheduleVisible,title:"选择排班"},on:{"update:visible":function(t){e.monthScheduleVisible=t}}},[s("el-form",{attrs:{model:e.monthScheduleQuery,inline:!0,"label-width":"120px"}},[s("el-form-item",{staticStyle:{float:"right"}},[s("el-input",{attrs:{size:"mini",placeholder:"请输入排班名称"},model:{value:e.monthScheduleQuery.name,callback:function(t){e.$set(e.monthScheduleQuery,"name",t)},expression:"monthScheduleQuery.name"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.monthScheduleSearch},slot:"suffix"})])],1)],1),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.monthScheduleLists,"tooltip-effect":"dark",size:"mini",height:"298"}},[s("el-table-column",{attrs:{label:"",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-radio",{attrs:{label:t.row.schedule_id},nativeOn:{change:function(s){return e.monthScheduleChange(t.$index,t.row)}},model:{value:e.monthScheduleType,callback:function(t){e.monthScheduleType=t},expression:"monthScheduleType"}})]}}])}),s("el-table-column",{attrs:{prop:"schedule_name",label:"排班名称",width:"120"}}),s("el-table-column",{attrs:{prop:"loop_time",label:"周期天数",width:"120"}}),s("el-table-column",{attrs:{prop:"start_date",label:"开始时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.transformDate(t.row.start_date))+" ")]}}])}),s("el-table-column",{attrs:{prop:"start_date",label:"混合模板",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:1===t.row.is_blend?"primary":"warning","disable-transitions":""}},[e._v(" "+e._s(t.row.is_blend?"是":"否")+" ")])]}}])})],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){e.monthScheduleVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.monthScheduleSubmit}},[e._v("确 定")])],1)],1)],1)},l=[],n=s("ade3"),a=(s("d3b7"),s("159b"),s("14d9"),s("ac1f"),s("841c"),s("4e82"),s("7db0"),s("4de4"),s("b0c0"),s("d81d"),s("a434"),s("ddb0"),s("a15b"),s("92a7")),c=s("ed08"),o=s("9358"),r=s("1a30"),d=s("435a"),u=s("b4c9"),h={data:function(){return{query_schedule:{schedule_name:null,page:null,size:null},schedules:[],current_page:1,page_rows:5,total_rows:0,showSearch:!0,saveScheduleVisible:!1,form:{schedule_id:null,schedule_name:"",start_date:"",loop_time:0,is_holiday:0,is_blend:0,classess:[],children_blends:[],user_ids:[]},holidayStatus:!1,editType:"1",weekDay:0,getInfo:!1,scheduleQuery:{schedule_name:null,page:0,size:1e3},scheduleList:[],month_schedules:[{id:0,schedule_month:"一月",schedule_name:"休息",schedule_id:"1001"},{id:1,schedule_month:"二月",schedule_name:"休息",schedule_id:"1002"},{id:2,schedule_month:"三月",schedule_name:"休息",schedule_id:"1003"},{id:3,schedule_month:"四月",schedule_name:"休息",schedule_id:"1004"},{id:4,schedule_month:"五月",schedule_name:"休息",schedule_id:"1005"},{id:5,schedule_month:"六月",schedule_name:"休息",schedule_id:"1006"},{id:6,schedule_month:"七月",schedule_name:"休息",schedule_id:"1007"},{id:7,schedule_month:"八月",schedule_name:"休息",schedule_id:"1008"},{id:8,schedule_month:"九月",schedule_name:"休息",schedule_id:"1009"},{id:9,schedule_month:"十月",schedule_name:"休息",schedule_id:"1010"},{id:10,schedule_month:"十一月",schedule_name:"休息",schedule_id:"1011"},{id:11,schedule_month:"十二月",schedule_name:"休息",schedule_id:"1012"}],monthScheduleChecked:[],monthScheduleVisible:!1,monthScheduleQuery:{name:""},monthScheduleLists:[],monthScheduleType:"",monthScheduleValue:"",dutyPersonVisible:!1,dutyPersonLoading:!1,dutyPersonQuery:{card_num:null,user_name:null,depart_id:null,post_id:null,role_id:null,hire_date:null},departCascaderProps:{value:"depart_id",label:"depart_name",children:"children"},hasPostsOfDepart:[],selectedPersons:[],query_users:[],userProps:{key:"user_id",label:"user_name"},dutyWeekVisible:!1,dutyWeekQuery:{name:""},dutyWeekShifts:[],dutyWeekType:"",dutyWeekTypeValue:"",work_classes:[{id:0,class_name:"周一",attend_time:"休息",class_id:"1001"},{id:1,class_name:"周二",attend_time:"休息",class_id:"1022"},{id:2,class_name:"周三",attend_time:"休息",class_id:"1033"},{id:3,class_name:"周四",attend_time:"休息",class_id:"1044"},{id:4,class_name:"周五",attend_time:"休息",class_id:"1055"},{id:5,class_name:"周六",attend_time:"休息",class_id:"1066"},{id:6,class_name:"周日",attend_time:"休息",class_id:"1077"}],work_classes_classIds:["1001","1022","1033","1044","1055","1066","1077",""],dutyWeekChecked:[],shiftSelected:null,dutyCycleShiftVisible:!1,dutyCycleShiftQuery:{att_cla_name:null,page:0,size:1e3},dutyCycleShiftLists:[],dutyCycleShiftChecked:[],tagType:["","success","info","warning","danger"],dutyCycleVisible:!1,dutyCycleShifts:[],dutyCycleIds:[],pickerOptions:{shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},dutyCycleSetting:{loop_time:2,values:[]},dutyCycles:[],departs:[],selectDeparts:[],classes:[]}},computed:{genFullDeparts:function(){var e=this,t=[];return null==this.departs||this.departs.length<=0||this.departs.forEach((function(s){if(null==s.parent_id){var i={};i.depart_id=s.depart_id,i.depart_name=s.depart_name,i.children=e.genChildrenDeparts(s.depart_id),t.push(i)}})),t}},created:function(){this.getScheduleList(),this.getAllDepart(),this.shiftInit(),this.scheduleListGet(),this.scheduleGet(),this.search()},methods:Object(n["a"])({tableHeadClassName:function(){return"table-head"},tableRowClassName:function(e){e.row;var t=e.rowIndex;return t%2==0?"success-row":"warning-row"},getScheduleList:function(){var e=this;this.query_schedule.page=this.current_page-1,this.query_schedule.size=this.page_rows,Object(a["b"])(this.query_schedule).then((function(t){5e3===t.result_code?0===t.content.content.length&&e.current_page>1?(e.current_page-=1,e.getScheduleList()):(e.schedules=t.content.content,e.total_rows=t.content.totalElements):e.$message.error(t.result_desc)}))},preAddSchedule:function(){},clearForm:function(){this.form.schedule_id=null,this.form.schedule_name="",this.form.start_date="",this.form.loop_time=0,this.form.is_holiday=0,this.form.is_blend=0,this.form.classess=[],this.form.children_blends=[],this.form.userIds=[]},addSchedule:function(){this.clearForm(),this.saveScheduleVisible=!0},editSchedule:function(e){var t=this;this.clearForm(),this.saveScheduleVisible=!0,this.title="修改周期排班";e.schedule_id||this.ids;Object(a["d"])({schedule_id:e.schedule_id}).then((function(e){t.saveScheduleVisible=!0,t.title="修改周期排班",t.form.schedule_id=e.content.schedule_id,t.form.schedule_name=e.content.schedule_name,t.form.start_date=e.content.start_date,t.form.loop_time=e.content.loop_time,t.form.is_holiday=e.content.is_holiday,t.form.is_blend=e.content.is_blend,t.form.classess=e.content.classess,t.form.children_blends=e.content.children_blends,t.form.user_ids=e.content.user_ids,t.holidayStatus=1===t.form.is_holiday,t.form.start_date&&(t.form.start_date=Object(c["e"])(t.form.start_date),t.weekDay=new Date(t.form.start_date).getDay()),t.scheduleInit()}))},scheduleDelete:function(e){var t=this;this.$confirm("是否确认删除当前排班周期?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(a["a"])({schedule_id:e.schedule_id}).then((function(e){5e3===e.result_code?(t.$message({type:"success",message:"删除成功!"}),t.getScheduleList()):t.$message.error(e.result_desc)})).catch((function(){}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},dutyWeekclear:function(e){e.attend_time="休息",e.dutyWeekType="",e.dutyWeekTypeValue="",0===e.id?e.class_id="1001":1===e.id?e.class_id="1022":2===e.id?e.class_id="1033":3===e.id?e.class_id="1044":4===e.id?e.class_id="1055":5===e.id?e.class_id="1066":6===e.id&&(e.class_id="1077"),this.dutyFormInit()},preUpdateSchedule:function(){},updateSchedule:function(){},search:function(){this.current_page=1,this.getScheduleList()},handleSizeChange:function(e){this.page_rows=e},handleCurrentChange:function(e){this.current_page=e,this.getScheduleList()},transformDate:function(e){return Object(c["i"])(e)},resetQuery:function(){this.resetForm("schedule"),this.handleQuery()},shiftInit:function(){var e=this;this.classes=[],Object(u["c"])(this.dutyCycleShiftQuery).then((function(t){5e3===t.result_code?t.content.content&&t.content.content.length>0&&t.content.content.forEach((function(t){e.classes.push({class_id:t.att_cla_id,class_name:t.att_cla_name,attend_time:t.claCloDtosList,total_hours:t.att_cla_totalHours,is_elastic:t.att_cla_isElastic})})):e.$message.error(t.result_desc)}))},scheduleListGet:function(){var e=this;this.scheduleList=[],Object(a["b"])(this.scheduleQuery).then((function(t){5e3===t.result_code?e.scheduleList=t.content.content:e.$message.error(t.result_desc)}))},scheduleGet:function(){var e=this;0!==this.scheduleList.length&&0!==this.classes.length||this.getInfo?(this.getInfo=!0,this.$route.params.schedule_id&&Object(a["d"])({schedule_id:this.$route.params.schedule_id}).then((function(t){5e3===t.result_code?(e.form=t.content,e.holidayStatus=1===e.form.is_holiday,e.form.start_date&&(e.form.start_date=Object(c["i"])(e.form.start_date),e.weekDay=new Date(e.form.start_date).getDay())):e.$message.error(t.result_desc),e.scheduleInit()})).catch((function(){return e.scheduleInit()}))):setTimeout((function(){e.scheduleGet()}),100)},scheduleInit:function(){this.form.is_blend?this.editType="3":this.editType=7===this.form.loop_time?"1":"2",this.editTypeChange()},changeDate:function(){var e=this,t=this.weekDay;this.weekDay=new Date(this.form.start_date).getDay(),this.weekDay=0===this.weekDay?7:this.weekDay;var s=this.weekDay-t;if("1"===this.editType){this.form.classess.forEach((function(e){e.class_no=e.class_no<=s?e.class_no-s+7:e.class_no-s>7?e.class_no-s-7:e.class_no-s})),this.form.classess.sort((function(e,t){return e.class_no>t.class_no?1:-1}));var i=["周一","周二","周三","周四","周五","周六","周日"],l=this.weekDay-1;this.work_classes=[];for(var n=function(t){var s=e.form.classess.find((function(e){return e.class_no===t+1}));e.work_classes.push({id:e.work_classes.length,class_name:i[l],attend_time:s?e.classes.find((function(e){return e.class_id===s.class_id})).class_name:"休息",class_id:s?s.class_id:""}),l=6===l?0:l+1},a=0;a<7;a++)n(a)}},dutyPersonInit:function(){this.dutyPersonVisible=!0,this.selectedPersons=this.form.user_ids,this.dutyPersonGet()},dutyPersonGet:function(){var e=this;this.dutyPersonLoading=!0,Object(r["b"])(this.dutyPersonQuery).then((function(t){5e3===t.result_code?(e.query_users=[],e.query_users=t.content.users):e.$message.error(t.result_desc),e.dutyPersonLoading=!1})).catch((function(){return e.dutyPersonLoading=!1}))},dutyPersonSubmit:function(){this.form.user_ids=this.selectedPersons,console.log(this.form.user_ids.length),this.dutyPersonVisible=!1},dutyWeekDelete:function(e,t){this.dutyWeekType="",this.dutyWeekTypeValue="",this.work_classes[t].attend_time="休息",this.work_classes[t].class_id="",this.dutyFormInit()},dutyWeekInit:function(e){if(this.dutyWeekShifts=this.classes,this.dutyWeekType="",this.dutyWeekTypeValue="",e&&e.class_name){this.dutyWeekType=e.class_id;var t=this.dutyWeekShifts.find((function(t){return t.class_id===e.class_id}));this.dutyWeekTypeValue=t?t.class_name:"",this.dutyWeekChecked=[],this.dutyWeekChecked.push(e)}this.dutyWeekVisible=!0},dutyWeekSearch:function(){var e=this;this.monthScheduleLists=this.classes.filter((function(t){return t.class_name.indexOf(e.dutyWeekQuery.name)>-1}))},dutyWeekCheckChange:function(e){this.dutyWeekChecked=e},dutyWeekChange:function(e,t){this.dutyWeekType=t.class_id,this.dutyWeekTypeValue=t.class_name},dutyWeekSubmit:function(){var e=this;if(this.dutyWeekType||this.dutyWeekTypeValue){if(this.dutyWeekChecked&&this.dutyWeekChecked.length>0&&this.dutyWeekChecked[0].class_name){var t=this.dutyWeekChecked.map((function(e){return e.id}));this.work_classes.forEach((function(s){t.indexOf(s.id)>-1&&(s.class_id=e.dutyWeekType,s.attend_time=e.dutyWeekTypeValue)}))}else this.work_classes.forEach((function(t){t.class_id=e.dutyWeekType,t.attend_time=e.dutyWeekTypeValue})),this.dutyWeekChecked=this.work_classes;console.log("this.dutyWeekChecked",this.dutyWeekChecked),this.dutyFormInit(),this.dutyWeekVisible=!1}},holidayChange:function(){this.form.is_holiday=this.holidayStatus?1:0},dutyCycleShiftInit:function(){var e=this;this.dutyCycleShiftLists=this.classes,this.dutyCycleShiftVisible=!0,this.$nextTick((function(){var t=e.dutyCycleShifts;e.$refs["multipleClassesTable"].clearSelection(),t&&t.length>0&&t.forEach((function(t){return e.$refs["multipleClassesTable"].toggleRowSelection(t)}))}))},dutyCycleShiftSearch:function(){var e=this;this.dutyCycleShiftLists=this.classes.filter((function(t){return t.class_name.indexOf(e.dutyCycleShiftQuery.name)>-1}))},handleSelClassChange:function(e){this.dutyCycleShiftChecked=e},dutyCycleShiftSubmit:function(){this.dutyCycleShifts=this.dutyCycleShiftChecked,this.dutyCycles=[],this.dutyCycleShiftVisible=!1},closeTag:function(e){this.dutyCycleShiftChecked.splice(this.dutyCycleShiftChecked.indexOf(e),1),this.dutyCycleShifts=this.dutyCycleShiftChecked,this.dutyCycles=[]},dutyCycleInit:function(e){if(e&&e.values?this.dutyCycleSetting={loop_time:e.loop_time,values:e.values}:this.dutyCycleSetting={loop_time:2,values:[]},0===this.dutyCycleSetting.values.length&&this.dutyCycleShifts.length>0)for(var t=0;t<this.dutyCycleSetting.loop_time;t++)this.dutyCycleSetting.values.push(this.dutyCycleShifts[0].class_id);this.dutyCycleVisible=!0},handleChange:function(e){for(var t=this.dutyCycleSetting.values.length;t<this.dutyCycleSetting.loop_time;t++)this.dutyCycleSetting.values.push(this.dutyCycleShifts[0].class_id)},dutyCycleSubmit:function(e){var t=this,s=this.dutyCycleShifts.map((function(e){return e.class_id})),i={loop_time:this.dutyCycleSetting.loop_time,values:this.dutyCycleSetting.values,valueStr:this.dutyCycleSetting.values.map((function(e){return t.dutyCycleShifts[s.indexOf(e)].class_name})).join("-")};e?this.dutyCycles.splice(e,1,i):this.dutyCycles.push(i),this.dutyFormInit(),this.dutyCycleVisible=!1},handleSecheduleChange:function(e){this.monthScheduleChecked=e},monthScheduleInit:function(e){if(this.monthScheduleLists=this.scheduleList,this.monthScheduleType="",this.monthScheduleValue="",e&&e.schedule_name){this.monthScheduleType=e.schedule_id;var t=this.monthScheduleLists.find((function(t){return t.schedule_id===e.schedule_id}));this.monthScheduleValue=t?t.schedule_name:"",this.monthScheduleChecked=[],this.monthScheduleChecked.push(e)}this.monthScheduleVisible=!0},monthScheduleSearch:function(){var e=this;this.monthScheduleLists=this.scheduleList.filter((function(t){return t.schedule_name.indexOf(e.monthScheduleQuery.name)>-1}))},goback:function(){this.saveScheduleVisible=!1},monthScheduleChange:function(e,t){this.monthScheduleType=t.schedule_id,this.monthScheduleValue=t.schedule_name},monthScheduleSubmit:function(){var e=this;if(this.monthScheduleType){if(this.monthScheduleChecked&&this.monthScheduleChecked.length>0&&this.monthScheduleChecked[0].schedule_name){var t=this.monthScheduleChecked.map((function(e){return e.id}));this.month_schedules.forEach((function(s){t.indexOf(s.id)>-1&&(s.schedule_id=e.monthScheduleType,s.schedule_name=e.monthScheduleValue)}))}else this.month_schedules.forEach((function(t){t.schedule_id=e.monthScheduleType,t.schedule_name=e.monthScheduleValue}));this.dutyFormInit(),this.monthScheduleVisible=!1}},editTypeChange:function(){var e=this;if("1"===this.editType)this.form.is_blend=0,this.changeDate();else if("2"===this.editType){this.form.is_blend=0,this.dutyCycleSetting.loop_time=this.form.loop_time,this.dutyCycleSetting.values=[];var t=0,s=[];for(this.dutyCycleShifts=[],this.form.classess.sort((function(e,t){return e.class_no>t.class_no?1:-1})),this.form.classess.forEach((function(i,l){if(l+1!=i.class_no){for(;t+1<i.class_no;)e.dutyCycleSetting.values.push(""),t++;s.push("")}e.dutyCycleSetting.values.push(i.class_id),s.push(i.class_id),t++}));t<this.form.loop_time;t++)this.dutyCycleSetting.values.push(""),s.push("");this.dutyCycleShifts&&0!==this.dutyCycleShifts.length||(this.dutyCycleShifts=this.classes.filter((function(e){return s.indexOf(e.class_id)>-1}))),this.dutyCycles=[],this.dutyCycles.push({start_date:this.form.start_date,loop_time:this.form.loop_time,values:this.dutyCycleSetting.values,valueStr:this.dutyCycleSetting.values.map((function(t){return e.dutyCycleShifts.find((function(e){return e.class_id===t})).class_name})).join("-")})}else if("3"===this.editType){this.form.is_blend=1,this.month_schedules=[];var i=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],l=0;for(this.form.children_blends.sort((function(e,t){return e.month>t.month?1:-1})),this.form.children_blends.forEach((function(t,s){if(s+1!=t.month)for(;l+1<t.month;)e.month_schedules.push({id:l,schedule_month:i[l],schedule_name:"",schedule_id:""}),l++;var n=e.scheduleList.find((function(e){return e.schedule_id===t.schedule_id}));e.month_schedules.push({id:l,schedule_month:i[l],schedule_name:n.schedule_name,schedule_id:t.schedule_id}),l++}));l<12;l++)this.month_schedules.push({id:l,schedule_month:i[l],schedule_name:"",schedule_id:""})}},dutyFormInit:function(){var e=this;"1"===this.editType?(this.form.loop_time=7,this.form.start_date=Object(c["i"])(this.getFirstDayOfWeek(new Date).getTime()),this.form.classess=this.work_classes.map((function(e,t){return{class_id:e.class_id,class_no:t+1}})).filter((function(t){if(""!==t.class_id){var s=e.work_classes_classIds.find((function(e){return t.class_id===e}));return!s}})),this.form.is_blend=0,this.form.children_blends=[]):"2"===this.editType?(this.form.loop_time=this.dutyCycleSetting.loop_time,this.form.classess=this.dutyCycleSetting.values.map((function(e,t){return{class_id:e,class_no:t+1}})).filter((function(e){return e.class_id})),this.form.is_blend=0,this.form.children_blends=[]):"3"===this.editType&&(this.form.loop_time=0,this.form.start_date=(new Date).getFullYear()+"-01-01",this.form.classess=[],this.form.is_blend=1,this.form.children_blends=this.month_schedules.map((function(e,t){return{child_id:e.schedule_id,month:t+1}})).filter((function(e){return e.child_id})))},getFirstDayOfWeek:function(e){var t=e.getDay()||7;return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1-t)},genChildrenDeparts:function(e){var t=this,s=[];return null==this.departs||this.departs.length<=0||this.departs.forEach((function(i){if(e===i.parent_id){var l={};l.depart_id=i.depart_id,l.depart_name=i.depart_name,l.children=t.genChildrenDeparts(i.depart_id),s.push(l)}})),s},getAllDepart:function(){var e=this;Object(o["a"])({}).then((function(t){if(5e3===t.result_code){console.log("this.departs_before",e.departs);var s=t.content;e.departs=s.departs}else e.$message.error(t.result_desc)}))},getAllPostsByDepart:function(e){var t=this;Object(d["a"])({depart_id:e}).then((function(e){5e3===e.result_code?t.hasPostsOfDepart=e.content.posts:t.$message.error(e.result_desc)}))},departSelecedChange:function(e){null!=e&&(this.dutyPersonQuery.depart_id=e[e.length-1],this.getAllPostsByDepart(e[e.length-1]))},addNeedClockDate:function(){},addUnNeedClockDate:function(){},isElastic:function(e){return 1===e||"1"===e?"是":"否"},saveSchedule:function(){var e=this;if(this.form.schedule_name)if(this.form.start_date)if(this.form.user_ids&&0!==this.form.user_ids.length){if("2"===this.editType){if(0===this.dutyCycles.length&&0===this.dutyCycleShiftLists.length)return void this.$message.error("请选择考勤班次");if(0===this.dutyCycles.length)return void this.$message.error("请设置排班周期")}console.log(this.form),Object(a["e"])(this.form).then((function(t){5e3===t.result_code?(e.$message({message:"排班保存成功",type:"success"}),setTimeout((function(){e.saveScheduleVisible=!1,e.getScheduleList()}),500)):e.$message.error(t.result_desc)})).catch((function(t){e.$message.error("保存失败！请重试！")}))}else this.$message.error("请选择考勤人员");else this.$message.error("请选择开始时间");else this.$message.error("排班名称不能为空")}},"transformDate",(function(e){return Object(c["i"])(e)}))},m=h,f=s("2877"),y=Object(f["a"])(m,i,l,!1,null,null,null);t["default"]=y.exports},"4e82":function(e,t,s){"use strict";var i=s("23e7"),l=s("e330"),n=s("59ed"),a=s("7b0b"),c=s("07fa"),o=s("083a"),r=s("577e"),d=s("d039"),u=s("addb"),h=s("a640"),m=s("04d1"),f=s("d998"),y=s("2d00"),_=s("512ce"),p=[],b=l(p.sort),g=l(p.push),S=d((function(){p.sort(void 0)})),v=d((function(){p.sort(null)})),k=h("sort"),C=!d((function(){if(y)return y<70;if(!(m&&m>3)){if(f)return!0;if(_)return _<603;var e,t,s,i,l="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(i=0;i<47;i++)p.push({k:t+i,v:s})}for(p.sort((function(e,t){return t.v-e.v})),i=0;i<p.length;i++)t=p[i].k.charAt(0),l.charAt(l.length-1)!==t&&(l+=t);return"DGBEFHACIJK"!==l}})),w=S||!v||!k||!C,x=function(e){return function(t,s){return void 0===s?-1:void 0===t?1:void 0!==e?+e(t,s)||0:r(t)>r(s)?1:-1}};i({target:"Array",proto:!0,forced:w},{sort:function(e){void 0!==e&&n(e);var t=a(this);if(C)return void 0===e?b(t):b(t,e);var s,i,l=[],r=c(t);for(i=0;i<r;i++)i in t&&g(l,t[i]);u(l,x(e)),s=c(l),i=0;while(i<s)t[i]=l[i++];while(i<r)o(t,i++);return t}})},"512ce":function(e,t,s){var i=s("342f"),l=i.match(/AppleWebKit\/(\d+)\./);e.exports=!!l&&+l[1]},addb:function(e,t,s){var i=s("4dae"),l=Math.floor,n=function(e,t){var s=e.length,o=l(s/2);return s<8?a(e,t):c(e,n(i(e,0,o),t),n(i(e,o),t),t)},a=function(e,t){var s,i,l=e.length,n=1;while(n<l){i=n,s=e[n];while(i&&t(e[i-1],s)>0)e[i]=e[--i];i!==n++&&(e[i]=s)}return e},c=function(e,t,s,i){var l=t.length,n=s.length,a=0,c=0;while(a<l||c<n)e[a+c]=a<l&&c<n?i(t[a],s[c])<=0?t[a++]:s[c++]:a<l?t[a++]:s[c++];return e};e.exports=n},d998:function(e,t,s){var i=s("342f");e.exports=/MSIE|Trident/.test(i)}}]);