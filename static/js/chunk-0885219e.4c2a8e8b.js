(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0885219e"],{"7a63":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"content"},[i("normal-table-render",{scopedSlots:e._u([{key:"actions",fn:function(t,s){return[i("div",[0==s.status?[i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-plus"},on:{click:function(t){return e.apply(s)}}},[e._v("提交申请")]),i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(t){return e.edit(s)}}},[e._v("编辑提交数据")]),i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return e.remove(s)}}},[e._v("删除")])]:1==s.status?[1==s.procInstStatus?i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-mouse"},on:{click:function(t){return e.cancel(s)}}},[e._v("撤回")]):e._e(),i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-aim"},on:{click:function(t){return e.history(s)}}},[e._v("查看进度")]),i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-pie-chart"},on:{click:function(t){return e.detail(s)}}},[e._v("表单数据")])]:2==s.status&&3==s.result||3==s.status?[i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-coin"},on:{click:function(t){return e.apply(s)}}},[e._v("重新申请")]),i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(t){return e.edit(s)}}},[e._v("编辑")]),i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-time"},on:{click:function(t){return e.history(s)}}},[e._v("审批历史")])]:[i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-pie-chart"},on:{click:function(t){return e.detail(s)}}},[e._v("表单数据")]),i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-time"},on:{click:function(t){return e.history(s)}}},[e._v("审批历史")])]],2)]}}])}),i("el-drawer",{attrs:{title:"选择流程",size:"33%",visible:e.processModalVisible},on:{"update:visible":function(t){e.processModalVisible=t}}},[i("div",{staticStyle:{padding:"10px"}},[i("div",{staticStyle:{display:"flex","align-items":"center","margin-bottom":"10px"}},[i("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"输入流程名称",clearable:""},model:{value:e.searchProcessKey,callback:function(t){e.searchProcessKey=t},expression:"searchProcessKey"}}),i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.onSearchProcess}},[e._v("搜索")])],1),i("process-choose",{attrs:{data:e.activeKeyAll,span:12},on:{chooseProcess:e.chooseProcess},model:{value:e.activeKey,callback:function(t){e.activeKey=t},expression:"activeKey"}})],1)]),i("Dialog",{attrs:{visible:e.visible,title:e.title,footer:!1,width:"50%"},on:{close:e.close}},[i(e.lcModa.formComponent,{tag:"component",attrs:{disabled:e.lcModa.disabled,processData:e.lcModa.processData,isNew:e.lcModa.isNew},on:{afterSubmit:e.afterSub,close:e.close}})],1),i("Dialog",{attrs:{visible:e.modalCancelVisible,title:"确认撤回",width:"500px"},on:{close:e.cancelClose,confirm:e.cancelConfirm}},[i("el-form",{ref:"delForm",attrs:{model:e.cancelForm,rules:e.cancelRules,"label-width":70}},[i("el-form-item",{attrs:{label:"撤回原因",prop:"reason"}},[i("el-input",{attrs:{type:"textarea",rows:4},model:{value:e.cancelForm.reason,callback:function(t){e.$set(e.cancelForm,"reason",t)},expression:"cancelForm.reason"}})],1)],1)],1),i("Dialog",{attrs:{title:"审批历史",width:"80%",footer:!1,visible:e.modalLsVisible},on:{close:function(t){e.modalLsVisible=!1}}},[i("history-detail",{attrs:{procInstId:e.procInstId}})],1)],1)},o=[],a=i("5530"),n=i("c7eb"),l=i("1da1"),c=(i("b0c0"),i("14d9"),i("d3b7"),i("159b"),i("a15b"),i("99af"),i("2076")),r=i("9039"),u=i("eab2"),d=i("a66f"),m=i("2140"),p=i("2ef0"),f=i("ecb5"),b=i("b775");function h(e){return b["a"].get("/system/actBusiness/listData",{params:e})}function y(e){return Object(b["a"])({url:"/system/actProcessIns/getFirstNode",method:"get",params:e})}function g(e){return b["a"].post("/system/actBusiness/apply",e)}function v(e){return Object(b["a"])({url:"/system/actBusiness/delByIds",method:"delete",params:e})}function w(e){return Object(b["a"])({url:"/system/actBusiness/cancel",method:"post",data:e})}var x=i("f8ab"),k={name:"ApplyList",mixins:[c["a"],x["a"]],components:{Dialog:r["a"],Panel:u["a"],HistoryDetail:d["a"],ProcessChoose:m["a"]},data:function(){var e=this,t=this.$createElement;return{lcModa:{disabled:!1,formComponent:null,isNew:!1,processData:{}},procInstId:"",searchProcessKey:"",activeKey:[],activeKeyAll:[],cancelForm:{},cancelRules:{reason:[{required:!0,message:"请输入"}]},title:"",visible:!1,processModalVisible:!1,modalCancelVisible:!1,modalLsVisible:!1,modalVisible:!1,showAssign:!1,isGateway:!1,dialogLabelWidth:"100px",dialogWidth:"650px",formRules:{assignees:[{required:!0,message:"请选择"}]},searchConfig:[{type:"input",model:"title",label:"标题"},{type:"select",model:"status",label:"状态",options:[{label:"草稿",value:"0"},{label:"处理中",value:"1"},{label:"已结束",value:"2"},{label:"已撤回",value:"3"}]},{type:"select",model:"result",label:"结果",options:[{label:"未提交",value:"0"},{label:"处理中",value:"1"},{label:"通过",value:"2"},{label:"驳回",value:"3"}]},{type:"dateTime",model:"createTimeRange",label:"创建时间"}],toolbarConfig:[{label:"发起申请",icon:"el-icon-plus",action:"add"}],dialogFormConfig:[{type:"select",label:"选择审批人",model:"assignees",multiple:!0,isShow:function(){return e.showAssign},options:[]},{type:"input",label:"下一审批人",model:"xxx",isShow:function(){return e.isGateway},render:function(){return t("el-alert",{style:"height: 32px;",attrs:{title:"分支网关处不支持自定义选择下一审批人，将发送给下一节点所有人。",type:"info",closable:!1}})}},{type:"select",label:"优先级",model:"priority",options:[{label:"普通",value:0},{label:"重要",value:1},{label:"紧急",value:2}]},{type:"checkbox",label:"消息通知",name:"站内消息通知",model:"sendMessage"}],tableColumns:[{key:"title",title:"标题",props:{width:"200"}},{key:"processName",title:"所属流程",props:{width:"200"}},{key:"currTaskName",title:"当前审批环节",props:{width:"150"}},{key:"status",title:"状态",props:{width:"150"},customRender:function(i,s){return t("span",{style:{color:e.getStatus(s.status).color}},[e.getStatus(s.status).text])}},{key:"result",title:"结果",props:{width:"150"},customRender:function(i,s){return t("span",{style:{color:e.getResult(s.status).color}},[e.getResult(s.status).text])}},{key:"createTime",title:"创建时间",props:{width:"160"}},{key:"applyTime",title:"申请时间",props:{width:"160"}},{key:"actions",title:"操作",props:{align:"center",minWidth:"250",fixed:"right"},scopedSlots:{customRender:"actions"}}]}},methods:{request:function(e){return Object(l["a"])(Object(n["a"])().mark((function t(){var i,s,o;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=e.createTimeRange,s=void 0===i?[]:i,e.createTime_begin=s[0],e.createTime_end=s[1],t.next=5,h(e);case 5:return o=t.sent,t.abrupt("return",{list:o.data});case 7:case"end":return t.stop()}}),t)})))()},buttonClick:function(e){switch(e.action){case"add":this.getProcessList();break}},getProcessList:function(){var e=this;Object(f["a"])({status:1,roles:!1}).then((function(t){if(console.log(t),200===t.code){var i=t.data||[];if(e.activeKeyAll=[],e.searchProcessKey&&(i=Object(p["filter"])(i,(function(t){return t.name.indexOf(e.searchProcessKey)>-1}))||[]),0!==i.length){var s=Object(p["groupBy"])(i,"categoryId");for(var o in s)e.activeKeyAll.push({categoryId:o,processList:s[o]}),e.activeKey.push(o)}else e.activeKeyAll=[],e.activeKey=[];e.processModalVisible=!0}}))},onSearchProcess:function(){this.getProcessList()},chooseProcess:function(e){if(!e.routeName)return this.$modal.msgWarning("该流程信息未配置表单，请联系开发人员！");this.title="发起流程："+(e.name||""),this.lcModa.formComponent=this.getFormComponent(e.routeName).component,this.lcModa.isNew=!0,this.lcModa.processData=e,this.lcModa.disabled=!1,this.visible=!0},apply:function(e){var t=this;if(!e.procDefId)return this.$modal.msgError("流程定义为空");this.$modal.confirm("确定提交申请吗?").then((function(){y({procDefId:e.procDefId,tableId:e.tableId,tableName:e.tableName}).then((function(i){var s={priority:0,sendMessage:!0,id:e.id,procDefId:e.procDefId,title:e.title},o="",n={data:{type:3},users:i.data.users};if(3==n.data.type||4==n.data.type)return t.isGateway=!0,t.formModel=Object(a["a"])(Object(a["a"])({},s),{},{firstGateway:!0}),t.showAssign=!1,t.dialogTitle="提交申请",void(t.dialogVisible=!0);if(t.formModel=Object(a["a"])(Object(a["a"])({},s),{},{firstGateway:!1}),t.isGateway=!1,n.data.users&&n.data.users.length>0){t.error="",t.assigneeList=n.data.users;var l=[];n.data.users.forEach((function(e){l.push(e.username)})),t.formModel=Object(a["a"])(Object(a["a"])({},t.formModel),{},{assignees:l}),t.showAssign=!0}else t.formModel=Object(a["a"])(Object(a["a"])({},t.formModel),{},{assignees:[]}),t.showAssign=!0,o="审批节点未分配候选审批人员，请联系管理员！";t.dialogTitle="提交申请",t.dialogVisible=!0,t.$nextTick((function(){o&&t.$modal.msgError(o)}))}))}))},confirm:function(e){var t=this;if(this.showAssign){if(this.formModel.assignees.length<1)return this.$modal.msgError("请至少选择一个审批人");this.formModel.assignees=this.formModel.assignees.join(",")}g(this.formModel).then((function(e){t.dialogVisible=!1,t.$modal.msgSuccess("操作成功"),t.reload()}))},closeDialog:function(){this.dialogVisible=!1},edit:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.routeName)return this.$modal.msgWarning("该流程信息未配置表单，请联系开发人员！");this.title="".concat(t?"查看":"修改","流程业务信息：").concat(e.title),this.lcModa.disabled=t,this.lcModa.formComponent=this.getFormComponent(e.routeName).component,this.lcModa.processData=e,this.lcModa.isNew=!1,this.visible=!0},remove:function(e){var t=this;this.$modal.confirm("确定删除吗").then((function(){v({ids:e.id}).then((function(e){t.reload(),t.$modal.msgSuccess("删除成功")}))}))},cancel:function(e){this.cancelForm.id=e.id,this.cancelForm.procInstId=e.procInstId,this.modalCancelVisible=!0},history:function(e){if(!e.procInstId)return this.$modal.msgError("流程实例ID不存在");this.procInstId=e.procInstId,this.modalLsVisible=!0},detail:function(e){this.edit(e,!0)},cancelConfirm:function(){var e=this;this.$refs.delForm.validate((function(t){t&&(w(e.cancelForm).then((function(t){e.$modal.msgSuccess("操作成功"),e.reload()})),e.modalCancelVisible=!1)}))},cancelClose:function(){this.modalCancelVisible=!1},close:function(){this.visible=!1},afterSub:function(e){this.visible=!1,this.reload()},getStatus:function(e){var t="未知",i="";return 0==e?(t="草稿",i="default"):1==e?(t="处理中",i="orange"):2==e?(t="已结束",i="blue"):3==e&&(t="已撤回",i="magenta"),{text:t,color:i}},getResult:function(e){var t="未知",i="";return 0==e?(t="未提交",i="default"):1==e?(t="处理中",i="orange"):2==e?(t="已通过",i="green"):3==e&&(t="已驳回",i="red"),{text:t,color:i}}}},I=k,M=(i("915a"),i("2877")),C=Object(M["a"])(I,s,o,!1,null,"2114db8c",null);t["default"]=C.exports},"915a":function(e,t,i){"use strict";i("bbaa")},bbaa:function(e,t,i){}}]);